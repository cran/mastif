<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="James S. Clark" />

<meta name="date" content="2024-01-22" />

<title>Mast Inference and Forecasting ( mastif )</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Mast Inference and Forecasting ( mastif
)</h1>
<h4 class="author"><a href="http://sites.nicholas.duke.edu/clarklab/">James S. Clark</a></h4>
<h4 class="date">2024-01-22</h4>


<div id="TOC">
<ul>
<li><a href="#summary" id="toc-summary"><span style="color:darkgreen">summary</span></a></li>
<li><a href="#mastif-inputs" id="toc-mastif-inputs"><span style="color:darkgreen"><code>mastif</code> inputs</span></a></li>
<li><a href="#simulated-data" id="toc-simulated-data"><span style="color:darkgreen">simulated data</span></a>
<ul>
<li><a href="#mastsim" id="toc-mastsim"><span style="color:teal"><code>mastSim</code></span></a></li>
<li><a href="#treedata-and-xytree" id="toc-treedata-and-xytree"><span style="color:teal"><code>treeData</code> and
<code>xytree</code></span></a></li>
<li><a href="#data-summary-and-maps" id="toc-data-summary-and-maps"><span style="color:teal">data summary and
maps</span></a></li>
</ul></li>
<li><a href="#model-fitting" id="toc-model-fitting"><span style="color:teal">model fitting</span></a>
<ul>
<li><a href="#output-summary-lists-and-plots" id="toc-output-summary-lists-and-plots"><span style="color:teal"><code>output</code> summary, lists, and
plots</span></a>
<ul>
<li><a href="#estimates-and-predictions-in-output" id="toc-estimates-and-predictions-in-output"><span style="color:brown">estimates, and predictions in
<code>output</code></span></a></li>
<li><a href="#plots-of-output" id="toc-plots-of-output"><span style="color:brown">plots of <code>output</code></span></a></li>
</ul></li>
<li><a href="#slow-convergence" id="toc-slow-convergence"><span style="color:teal">slow convergence?</span></a></li>
<li><a href="#multiple-seed-types-per-species" id="toc-multiple-seed-types-per-species"><span style="color:teal">multiple seed types per species</span></a></li>
<li><a href="#specnames-and-seednames" id="toc-specnames-and-seednames"><span style="color:teal"><code>specNames</code> and
<code>seedNames</code></span></a></li>
</ul></li>
<li><a href="#mastplot-written-to-files" id="toc-mastplot-written-to-files"><span style="color:brown"><code>mastPlot</code> written to
files</span></a></li>
<li><a href="#my-data" id="toc-my-data"><span style="color:darkgreen">my
data</span></a>
<ul>
<li><a href="#diameter-effect" id="toc-diameter-effect"><span style="color:teal">diameter effect</span></a></li>
<li><a href="#year-and-random-effects" id="toc-year-and-random-effects"><span style="color:teal">year and
random effects</span></a></li>
<li><a href="#prior-parameter-values" id="toc-prior-parameter-values"><span style="color:teal">prior parameter
values</span></a></li>
<li><a href="#maturationfecundity-data-if-available" id="toc-maturationfecundity-data-if-available"><span style="color:teal">maturation/fecundity data, if
available</span></a></li>
<li><a href="#when-trees-are-sampled-less-frequently-than-seeds" id="toc-when-trees-are-sampled-less-frequently-than-seeds"><span style="color:teal">when trees are sampled less frequently than
seeds</span></a></li>
<li><a href="#adding-covariates" id="toc-adding-covariates"><span style="color:teal">adding covariates</span></a></li>
</ul></li>
<li><a href="#flexibility" id="toc-flexibility"><span style="color:darkgreen">flexibility</span></a>
<ul>
<li><a href="#random-individual-effects" id="toc-random-individual-effects"><span style="color:teal">random
individual effects</span></a></li>
<li><a href="#random-groups-for-years-and-lags" id="toc-random-groups-for-years-and-lags"><span style="color:teal">random groups for years and lags</span></a></li>
<li><a href="#random-effects-when-there-are-multiple-species" id="toc-random-effects-when-there-are-multiple-species"><span style="color:teal">random effects when there are multiple
species</span></a></li>
</ul></li>
<li><a href="#convergence" id="toc-convergence"><span style="color:darkgreen">convergence</span></a></li>
<li><a href="#time-series-volatility-and-periodicity" id="toc-time-series-volatility-and-periodicity"><span style="color:darkgreen">time series: volatility and
periodicity</span></a></li>
<li><a href="#trouble-shooting" id="toc-trouble-shooting"><span style="color:darkgreen">trouble shooting</span></a></li>
<li><a href="#references" id="toc-references"><span style="color:darkgreen">references</span></a></li>
</ul>
</div>

<div id="citation" class="section level4">
<h4>citation:</h4>
<p>Clark, JS, C Nunes, and B Tomasek. 2019. Masting as an unreliable
resource: spatio-temporal host diversity merged with consumer movement,
storage, and diet. <a href="https://esajournals.onlinelibrary.wiley.com/doi/10.1002/ecm.1381"><em>Ecological
Monographs</em>, e01381</a>.</p>
<p>Qiu, T. …, and J. S. Clark. 2023. Mutualist dispersers and the global
distribution of masting: mediation by climate and fertility. <a href="https://doi.org/10.1038/s41477-023-01446-5"><em>Nature Plants</em>
9, 1044–1056</a>.</p>
<p><a href="http://sites.nicholas.duke.edu/clarklab/r-packages/disperse/">website</a></p>
<p><br></p>
</div>
<div id="summary" class="section level2">
<h2><span style="color:darkgreen">summary</span></h2>
<p><code>mastif</code> uses seed traps and crop counts on trees to
estimate seed productivity and dispersion. Attributes of individual
trees and their local environments could explain their differences in
fecundity. Inference requires information on locations of trees and seed
traps and predictors ( covariates and factors ) that could explain
source strength.</p>
<p>Many trees are not reproductively mature, and reproductive status is
often unknown. For individuals of unknown maturation status, the
maturation status must be estimated together with fecundity.</p>
<p>Predictors of fecundity include individual traits, site
characteristics, climate, synchronicity with other trees, and lag
effects. For studies that involve multiple plots and years, there can be
effects of climate between sites and through time. There may be
synchronicity between individuals both within and between plots.</p>
<p>Observations incorporate two types of redistribution. The first type
is a redistribution from species to seed types. Not all seed types can
be definitely assigned to species. The contribution of trees of each
species to multiple seed types must be estimated.</p>
<p>The second redistribution from source trees to seed traps. Within a
plot-year there is dependence between all seed traps induced by a
redistribution kernel, which describes how seeds produced by trees are
dispersed in space. Because ‘seed shadows’ of trees overlap, seeds are
assigned to trees only in a probabilistic sense. The capacity to obtain
useful estimates depends on the number of trees, the number of seed
traps, the dispersal distances of seeds, the taxonomic specificity of
seed identification, and the number of species contributing to a given
seed type.</p>
<p>In addition to covariates and factors, the process model for
fecundity can involve random tree effects, random group effects ( e.g.,
species-location ), year effects, and autoregressive lags limited only
by the duration of data. Dispersal estimtes can include species and site
differences ( Clark et al. 2013 ).</p>
<p><code>mastif</code> simulates the posterior distributions of
parameters and latent variables using Gibbs sampling, with direct
sampling, Hamiltonian Markov chain ( HMC ) updates, and Metropolis
updates. <code>mastif</code> is implemented in R and C++ with
<code>Rcpp</code> and <code>RcppArmadillo</code> libraries.</p>
<p><br></p>
</div>
<div id="mastif-inputs" class="section level1">
<h1><span style="color:darkgreen"><code>mastif</code> inputs</span></h1>
<p>The model requires a minimum of six inputs directly as arguments to
the function <code>mastif</code>. There are two <code>formula</code>s,
two <code>character vector</code>s, and four
<code>data.frame</code>s:</p>
<p><strong>Table 2</strong>. Basic inputs</p>
<table>
<colgroup>
<col width="18%" />
<col width="28%" />
<col width="52%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">object</th>
<th align="center"><code>mode</code></th>
<th align="left">components</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><code>formulaFec</code></td>
<td align="center"><code>formula</code></td>
<td align="left">fecundity model</td>
</tr>
<tr class="even">
<td align="right"><code>formulaRep</code></td>
<td align="center"><code>formula</code></td>
<td align="left">maturation model</td>
</tr>
<tr class="odd">
<td align="right"><code>specNames</code></td>
<td align="center"><code>character vector</code></td>
<td align="left">names in column <code>species</code> of
<code>treeData</code> to include in model</td>
</tr>
<tr class="even">
<td align="right"><code>seedNames</code></td>
<td align="center"><code>character vector</code></td>
<td align="left">names of seed types to include in model: match column
names in <code>seedData</code></td>
</tr>
<tr class="odd">
<td align="right"><code>treeData</code></td>
<td align="center"><code>data.frame</code></td>
<td align="left">tree-year by variables, includes columns
<code>plot</code>, <code>tree</code>, <code>year</code>,
<code>diam</code>, <code>repr</code></td>
</tr>
<tr class="even">
<td align="right"><code>seedData</code></td>
<td align="center"><code>data.frame</code></td>
<td align="left">trap-year by seed types, includes columns
<code>plot</code>, <code>trap</code>, <code>year</code>, one for each
<code>specNames</code></td>
</tr>
<tr class="odd">
<td align="right"><code>xytree</code></td>
<td align="center"><code>data.frame</code></td>
<td align="left">tree by location, includes columns <code>plot</code>,
<code>tree</code>, <code>x</code>, <code>y</code></td>
</tr>
<tr class="even">
<td align="right"><code>xytrap</code></td>
<td align="center"><code>data.frame</code></td>
<td align="left">trap by location, includes columns <code>plot</code>,
<code>trap</code>, <code>x</code>, <code>y</code></td>
</tr>
</tbody>
</table>
<p>I introduce additional inputs in the sections that follow, but start
with this basic model.</p>
<p><br></p>
</div>
<div id="simulated-data" class="section level1">
<h1><span style="color:darkgreen">simulated data</span></h1>
<p>Data simulation is recommended as the place to start. A simulator
provides insight on how well parameters from be identified from my data.
The inputs to the simulator can specify the following:</p>
<p><strong>Table 3.</strong> Simulation inputs to
<code>mastSim</code></p>
<table>
<thead>
<tr class="header">
<th align="center"><code>mastSim</code> input</th>
<th align="left">explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>nplot</code></td>
<td align="left">number of plots</td>
</tr>
<tr class="even">
<td align="center"><code>nyr</code></td>
<td align="left">mean no. years per plot</td>
</tr>
<tr class="odd">
<td align="center"><code>ntree</code></td>
<td align="left">mean no. trees per plot</td>
</tr>
<tr class="even">
<td align="center"><code>ntrap</code></td>
<td align="left">mean no. traps per plot</td>
</tr>
<tr class="odd">
<td align="center"><code>specNames</code></td>
<td align="left">tree species codes used in <code>treeData</code>
column</td>
</tr>
<tr class="even">
<td align="center"><code>seedNames</code></td>
<td align="left">seed type codes: a column name in
<code>seedData</code></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( mastif )</span></code></pre></div>
<p>Most of these inputs are stochasiticized to vary structure of each
data set. Here are inputs to the simulator for a species I’ll call
<code>acerRubr</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>seedNames  <span class="ot">&lt;-</span> specNames  <span class="ot">&lt;-</span> <span class="st">&#39;acerRubr&#39;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">nplot=</span><span class="dv">5</span>, <span class="at">nyr=</span><span class="dv">10</span>, <span class="at">ntree=</span><span class="dv">30</span>,  <span class="at">ntrap=</span><span class="dv">40</span>, <span class="at">specNames =</span> specNames, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">seedNames =</span> seedNames )</span></code></pre></div>
<p>The <code>list sim</code> holds objects needed for simulation. Here
is the simulation:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>inputs     <span class="ot">&lt;-</span> <span class="fu">mastSim</span>( sim )        <span class="co"># simulate dispersal data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>seedData   <span class="ot">&lt;-</span> inputs<span class="sc">$</span>seedData     <span class="co"># year, plot, trap, seed counts</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>treeData   <span class="ot">&lt;-</span> inputs<span class="sc">$</span>treeData     <span class="co"># year, plot, tree data</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>xytree     <span class="ot">&lt;-</span> inputs<span class="sc">$</span>xytree       <span class="co"># tree locations</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>xytrap     <span class="ot">&lt;-</span> inputs<span class="sc">$</span>xytrap       <span class="co"># trap locations</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>formulaFec <span class="ot">&lt;-</span> inputs<span class="sc">$</span>formulaFec   <span class="co"># fecundity model</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>formulaRep <span class="ot">&lt;-</span> inputs<span class="sc">$</span>formulaRep   <span class="co"># maturation model</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>trueValues <span class="ot">&lt;-</span> inputs<span class="sc">$</span>trueValues   <span class="co"># true states and parameter values</span></span></code></pre></div>
<p>I first summarize these model <code>inputs</code> generated by
<code>mastSim</code>.</p>
<div id="mastsim" class="section level2">
<h2><span style="color:teal"><code>mastSim</code></span></h2>
<p><code>mastSim</code> generates inputs needed for model fitting with
<code>mast</code>. These objects are simulated data, including the four
<code>data.frame</code>s ( <code>treeData</code>, <code>seedData</code>,
<code>xytree</code>, <code>xytrap</code> ) and formulas (
<code>formulaFec</code>, <code>formulaRep</code> ). Other objects are
“true” parameter values and latent states in the
<code>list truevalues</code> used to simulate the data (
<code>fec</code>, <code>repr</code>, <code>betaFec</code>,
<code>betaRep</code>, <code>upar</code>, <code>R</code> ). I want to see
if <code>mast</code> can recover these parameter values for the type of
data I simulated.</p>
<p>Here is a mapping of objects created by <code>mastSim</code> to the
model in Clark et al. ( 2019 ):</p>
<p><strong>Table 4.</strong> Some of the objects from the
<code>list mastSim</code>.</p>
<table>
<colgroup>
<col width="31%" />
<col width="27%" />
<col width="40%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"><code>mastSim</code> object</th>
<th align="center">variable</th>
<th align="left">explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>trueValues$fec</code></td>
<td align="center"><span class="math inline">\(\psi_{ij,
t}\)</span></td>
<td align="left">conditional fecundity</td>
</tr>
<tr class="even">
<td align="center"><code>trueValues$repr</code></td>
<td align="center"><span class="math inline">\(\rho_{ij,
t}\)</span></td>
<td align="left">true maturation status</td>
</tr>
<tr class="odd">
<td align="center"><code>treeData$repr</code></td>
<td align="center"><span class="math inline">\(z_{ij, t}\)</span></td>
<td align="left">observed maturation status ( with <code>NA</code>
)</td>
</tr>
<tr class="even">
<td align="center"><code>trueValues$betaFec</code></td>
<td align="center"><span class="math inline">\(\beta^x\)</span></td>
<td align="left">coefficients for fecundity</td>
</tr>
<tr class="odd">
<td align="center"><code>trueValues$betaRep</code></td>
<td align="center"><span class="math inline">\(\beta^v\)</span></td>
<td align="left">coefficients for maturation</td>
</tr>
<tr class="even">
<td align="center"><code>trueValues$R</code></td>
<td align="center"><span class="math inline">\(\mathbf{m}\)</span></td>
<td align="left"><code>specNames</code> to
<code>seedNames matrix</code>, rows = <span class="math inline">\(\mathbf{m}_h\)</span></td>
</tr>
<tr class="odd">
<td align="center"><code>seedData$active</code></td>
<td align="center">in <span class="math inline">\(A_{sj,
t}\)</span></td>
<td align="left">fraction of time trap is active</td>
</tr>
<tr class="even">
<td align="center"><code>seedData$area</code></td>
<td align="center">in <span class="math inline">\(A_{sj,
t}\)</span></td>
<td align="left">trap area</td>
</tr>
</tbody>
</table>
<p><code>mastSim</code> assumes that predictors of maturation and
fecundity are limited to intercept and diameter. Thus, the
<code>formulaFec</code> and <code>formulaRep</code> are identical. Here
is fecundity:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>formulaFec</span></code></pre></div>
<p>Before fitting the model I say a bit more about input data.</p>
</div>
<div id="treedata-and-xytree" class="section level2">
<h2><span style="color:teal"><code>treeData</code> and
<code>xytree</code></span></h2>
<p>The information on individual trees is held in the tree-years by
variables <code>data.frame treeData</code>. Here are a few lines of
<code>treeData</code> generated by <code>mastSim</code>,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( treeData )</span></code></pre></div>
<p><code>treeData</code> has a row for each tree-year. Several of these
columns are required:</p>
<p><strong><code>data.frame treeData</code> columns</strong></p>
<table>
<colgroup>
<col width="25%" />
<col width="74%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"><code>treeData</code> column</th>
<th align="left">explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>plot</code></td>
<td align="left">plot name</td>
</tr>
<tr class="even">
<td align="center"><code>tree</code></td>
<td align="left">identifier for each tree, unique within a plot</td>
</tr>
<tr class="odd">
<td align="center"><code>year</code></td>
<td align="left">observation year</td>
</tr>
<tr class="even">
<td align="center"><code>species</code></td>
<td align="left">species name</td>
</tr>
<tr class="odd">
<td align="center"><code>diam</code></td>
<td align="left">diameter is a predictor for fecundity in <span class="math inline">\(\mathbf{X}\)</span> and maturation in <span class="math inline">\(\mathbf{V}\)</span></td>
</tr>
<tr class="even">
<td align="center"><code>repr</code></td>
<td align="left">immature ( <code>0</code> ), mature ( <code>1</code> ),
or unknown ( <code>NA</code> )</td>
</tr>
</tbody>
</table>
<p>There can be additional columns, but they are not required for model
fitting. The variable <code>repr</code> is reproduction status, often
<code>NA</code>.</p>
<p>There is a corresponding <code>data.frame xytree</code> that holds
tree locations.</p>
<p><strong>Table 5.</strong> <code>data.frame xytree</code> columns</p>
<table>
<thead>
<tr class="header">
<th align="center"><code>xytree</code> column</th>
<th align="left">explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>plot</code></td>
<td align="left">plot name</td>
</tr>
<tr class="even">
<td align="center"><code>tree</code></td>
<td align="left">identifier for each tree, unique within a plot</td>
</tr>
<tr class="odd">
<td align="center"><code>x, y</code></td>
<td align="left">locations in the sample plot</td>
</tr>
</tbody>
</table>
<p><code>xytree</code> has fewer rows than <code>treeData</code>,
because it is not repeated each year–it assumes that tree locations are
fixed. They are cross-referenced by <code>plot</code> and
<code>tree</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( xytree, <span class="dv">5</span> )</span></code></pre></div>
<p>##<span style="color:teal"><code>seedData</code> and
<code>xytrap</code></span></p>
<p>Seed counts are held in the <code>data.frame seedData</code> as
trap-years by seed types. Here are a few lines of
<code>seedData</code>,</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( seedData )</span></code></pre></div>
<p>Required columns are in Table 6.</p>
<p><strong>Table 6.</strong> <code>data.frame seedData</code>
columns</p>
<table>
<colgroup>
<col width="25%" />
<col width="74%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"><code>seedData</code> column</th>
<th align="left">explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>plot</code></td>
<td align="left">plot name</td>
</tr>
<tr class="even">
<td align="center"><code>trap</code></td>
<td align="left">identifier for each trap, unique within a plot</td>
</tr>
<tr class="odd">
<td align="center"><code>year</code></td>
<td align="left">seed-crop year</td>
</tr>
<tr class="even">
<td align="center"><code>active</code></td>
<td align="left">fraction of collecting period that the trap was
active</td>
</tr>
<tr class="odd">
<td align="center"><code>area</code></td>
<td align="left">collection area of trap ( m<span class="math inline">\(^2\)</span> )</td>
</tr>
<tr class="even">
<td align="center"><code>acerRubr</code>, …</td>
<td align="left"><code>seedNames</code> for columns with seed
counts</td>
</tr>
</tbody>
</table>
<p>Seed trap location data are held in the
<code>data.frame xytrap</code>.</p>
<p><strong>Table 7.</strong> <code>data.frame xytrap</code> columns</p>
<table>
<thead>
<tr class="header">
<th align="center"><code>xytrap</code> column</th>
<th align="left">explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>plot</code></td>
<td align="left">plot name</td>
</tr>
<tr class="even">
<td align="center"><code>trap</code></td>
<td align="left">identifier for each trap, unique within a plot</td>
</tr>
<tr class="odd">
<td align="center"><code>x, y</code></td>
<td align="left">map location</td>
</tr>
</tbody>
</table>
<p>There is no year in <code>xytrap</code>, because locations are
assumed to be fixed. If a seed trap location is moved during a study,
simply assign it a new trap name. Then seed counts for years when it is
not present are assigned <code>NA</code> ( missing data ) will be
imputed.</p>
<p><br></p>
</div>
<div id="data-summary-and-maps" class="section level2">
<h2><span style="color:teal">data summary and maps</span></h2>
<p>Because they are stochastic, not all simulations from
<code>mastSim</code> generate data with sufficient pattern to allow
model fitting. I can look at the relationship between tree diameters and
seeds on a map for plot <code>mapPlot</code> and year
<code>mapYear</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dataTab <span class="ot">&lt;-</span> <span class="fu">table</span>( treeData<span class="sc">$</span>plot, treeData<span class="sc">$</span>year )</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">which</span>( dataTab <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">arr.ind=</span>T ) <span class="co"># a plot-year with observations</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> w[<span class="fu">sample</span>( <span class="fu">nrow</span>( w ), <span class="dv">1</span> ), ]</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>mapYears <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>( <span class="fu">colnames</span>( dataTab )[w[<span class="dv">2</span>]] )</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>mapPlot  <span class="ot">&lt;-</span> <span class="fu">rownames</span>( dataTab )[w[<span class="dv">1</span>]]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>mapPlot    <span class="ot">&lt;-</span> mapPlot</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>mapYears   <span class="ot">&lt;-</span> mapYears</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>treeSymbol <span class="ot">&lt;-</span> treeData<span class="sc">$</span>diam</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>SCALEBAR   <span class="ot">&lt;-</span> T</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mastMap</span>( inputs )</span></code></pre></div>
<p>Depending on the numbers and sizes of maps I adust
<code>treeScale</code> and <code>trapScale</code> to see how seed
accumulation compares with tree size or fecundity. In the above map,
trees are shown as green circles and traps as gray squares. The size of
the circle comes from the input variable <code>treeSymbol</code>, which
is set to tree diameter. I could instead set it to the ‘true’ number of
seeds produced by each tree, an output from <code>mastSim</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>treeSymbol <span class="ot">&lt;-</span> trueValues<span class="sc">$</span>fec</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>treeScale  <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>trapScale  <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mastMap</span>( inputs )</span></code></pre></div>
<p>Which are reproductive (mature)? Here are true values, showing just
trees that are mature:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>treeSymbol <span class="ot">&lt;-</span> trueValues<span class="sc">$</span>repr</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>treeScale  <span class="ot">&lt;-</span> .<span class="dv">5</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mastMap</span>( inputs )</span></code></pre></div>
<p>To fit the data, there must be sufficient seed traps, and sources
must not be so dense such that overlapping seed shadows make the
individual contributions undetectable.</p>
<p>Here is the frequency distribution of seeds ( observed ) and of
fecundities ( unknown ) from the simulated data:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>( <span class="at">mfrow=</span><span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span> ), <span class="at">bty=</span><span class="st">&#39;n&#39;</span>, <span class="at">mar=</span><span class="fu">c</span>( <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span> ) )</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>seedData  <span class="ot">&lt;-</span> inputs<span class="sc">$</span>seedData</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>seedNames <span class="ot">&lt;-</span> inputs<span class="sc">$</span>seedNames</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>( <span class="fu">as.matrix</span>( seedData[, seedNames] ) , <span class="at">nclass=</span><span class="dv">100</span>, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">&#39;seed count&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;per trap&#39;</span>, <span class="at">main=</span><span class="st">&#39;&#39;</span> )</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>( trueValues<span class="sc">$</span>fec, <span class="at">nclass=</span><span class="dv">100</span>, <span class="at">xlab =</span> <span class="st">&#39;seeds produced&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;per tree&#39;</span>, <span class="at">main =</span> <span class="st">&#39;&#39;</span> )</span></code></pre></div>
<p>In data of this type, most seed counts and most tree fecundities are
zero.</p>
<p><br></p>
</div>
</div>
<div id="model-fitting" class="section level1">
<h1><span style="color:teal">model fitting</span></h1>
<p>Model fitting requires specification of the number of MCMC iterations
<code>ng</code> and the <code>burnin</code>. Here is an analysis using
the simulated <code>inputs</code> from <code>mastSim</code> with a small
number of iterations:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>output   <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> inputs, <span class="at">ng =</span> <span class="dv">4000</span>, <span class="at">burnin =</span> <span class="dv">500</span> )</span></code></pre></div>
<p>The fitted object <code>output</code> contains MCMC chains,
estimates, and predictions, summarized in the next section.</p>
<div id="output-summary-lists-and-plots" class="section level2">
<h2><span style="color:teal"><code>output</code> summary, lists, and
plots</span></h2>
<p>Sample size, parameter estimates, goodness of fit are all provides as
tables by <code>summary</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( output )</span></code></pre></div>
<p>By default, this summary is sent to the console. It can also be saved
to a <code>list</code>, e.g.,
<code>outputSummary &lt;- summary( output )</code>.</p>
<div id="estimates-and-predictions-in-output" class="section level3">
<h3><span style="color:brown">estimates, and predictions in
<code>output</code></span></h3>
<p>The main objects returned by <code>mastif</code> include several
lists summarized in Table 9. <code>parameters</code> are estimated as
part of model fitting. <code>predictions</code> are generated by the
fitted model, as predictive distributions. Note that the latent states
for log fecundity <span class="math inline">\(\psi_{ij, t}\)</span> and
maturation state <span class="math inline">\(\rho_{ij, t}\)</span> are
both estimated and predicted.</p>
<p><strong>Table 9.</strong> The <code>list</code> created by function
<code>mast</code>.</p>
<table>
<colgroup>
<col width="21%" />
<col width="13%" />
<col width="64%" />
</colgroup>
<thead>
<tr class="header">
<th align="right"><code>list</code> in <code>output</code></th>
<th align="center">summary</th>
<th align="left">contents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><code>inputs</code></td>
<td align="center">from <code>inputs</code> with additions</td>
<td align="left">includes <code>distall</code> ( trap by tree distance
)</td>
</tr>
<tr class="even">
<td align="right"><code>chains</code></td>
<td align="center">MCMC chains</td>
<td align="left"><code>agibbs</code> ( if random effects, the covariance
matrix <span class="math inline">\(\mathbf{A}\)</span> ),
<code>bfec</code> ( <span class="math inline">\(\boldsymbol{\beta}^x\)</span> ), <code>brep</code>
( <span class="math inline">\(\boldsymbol{\beta}^v\)</span> ),
<code>bygibbs</code> ( <span class="math inline">\(\alpha_l\)</span> or
<span class="math inline">\(\gamma_t\)</span> if <code>yearEffect</code>
included ), <code>rgibbs</code> ( <span class="math inline">\(\mathbf{M}\)</span> if multiple seed types ),
<code>sgibbs</code> ( <span class="math inline">\(\sigma^2\)</span>,
RMSPE, deviance ), <code>ugibbs</code> ( <span class="math inline">\(u\)</span> parameter )</td>
</tr>
<tr class="odd">
<td align="right"><code>data</code></td>
<td align="center">data attributes</td>
<td align="left">intermediate objects used in fitting, prediction</td>
</tr>
<tr class="even">
<td align="right"><code>fit</code></td>
<td align="center">diagnostics</td>
<td align="left">DIC, RMSPE, scoreStates, predictScore</td>
</tr>
<tr class="odd">
<td align="right"><code>parameters</code></td>
<td align="center">posterior summaries</td>
<td align="left"><code>alphaMu</code> and <code>alphaSe</code> ( mean
and se for <span class="math inline">\(\mathbf{A}\)</span>, if included
), <code>aMu</code> and <code>aSe</code> ( <span class="math inline">\(\mathbf{\beta^w}_{ij}\)</span> ),
<code>betaFec</code> ( <span class="math inline">\(\boldsymbol{\beta}^x\)</span> ),
<code>betaRep</code> ( <span class="math inline">\(\boldsymbol{\beta}^v\)</span> ),
<code>betaYrMu</code> and <code>betaYrSe</code> ( mean and se for year
or lag coefficients ), <code>upars</code> and <code>dpars</code> (
dispersal parameters <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span> ), <code>rMu</code> and
<code>rSe</code> ( mean and se for <span class="math inline">\(\mathbf{M}\)</span> ), <code>sigma</code> ( <span class="math inline">\(\sigma^2\)</span> ), <code>acfMat</code> ( group
by lag empirical correlation or ACF ), <code>pacfMat</code> ( group by
lag partial correlation or PACF ), <code>pacfSe</code> ( se for
<code>pacfMat</code> ), <code>pacsMat</code> ( group by lag PACF for
seed data )</td>
</tr>
<tr class="even">
<td align="right"><code>prediction</code></td>
<td align="center">predictive distributions</td>
<td align="left"><code>fecPred</code> ( maturation <span class="math inline">\(\rho_{ij, t}\)</span> and fecundity <span class="math inline">\(\psi_{ij, t}\)</span> estimates and predictions ),
<code>seedPred</code> ( seed counts per trap and predictions per m<span class="math inline">\(^2\)</span> ), <code>seedPredGrid</code>
predictions for seeds on the space-time prediction grid,
<code>treePredGrid</code> predictions for maturation and fecundity
corresponding to <code>seedPredGrid</code>.</td>
</tr>
</tbody>
</table>
<p>Prediction scores for seed-trap observations are provided in
<code>output$fit</code> based on the estimated fecundities <span class="math inline">\([\mathbf{y} | \phi, \rho]\)</span> as
<code>scoreStates</code> and on the estimated parameters <span class="math inline">\([\mathbf{y} | \phi, \rho][\phi, \rho|
\boldsymbol{\beta}^x, \boldsymbol{\beta}^w, \dots]\)</span> as
<code>predictScore</code>. The former will be substantially higher than
the latter in cases where estimates of states <span class="math inline">\(\phi, \rho\)</span> can be found that predict seed
data, but the variables in <span class="math inline">\(\mathbf{X},
\mathbf{V}\)</span> do not predict those states well. These proper
scoring rules are bases on the log likelihood for the Poisson
distribution.</p>
<p>Predictions for a location-year prediction grid are invoked when
<code>predList</code> is specified in the call to
<code>mastif</code>.</p>
</div>
<div id="plots-of-output" class="section level3">
<h3><span style="color:brown">plots of <code>output</code></span></h3>
<p>Here are plots of <code>output</code>, with the
<code>list plotPars</code> passing the <code>trueValues</code> for these
simulated data:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plotPars <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">trueValues =</span> trueValues )</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output, plotPars )</span></code></pre></div>
<p>Because this is a simulated data set, I pass the
<code>trueValues</code> in the <code>list plotPars</code>.</p>
<p>By inspecting chains I decide that it is not converged and continue,
with <code>output</code> from the previous fit being the new
<code>inputs</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>output   <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> output, <span class="at">ng =</span> <span class="dv">5000</span>, <span class="at">burnin =</span> <span class="dv">3000</span> )</span></code></pre></div>
<p>Other arguments passed to <code>mastPlot</code> in the
<code>list plotPars</code> are given as examples below and listed at
<code>help( mastPlot )</code>.</p>
<p><code>mastPlot</code> generates the following plots:</p>
<ul>
<li><p><code>maturation</code>: chains for maturation parameters in
<span class="math inline">\(\beta^v\)</span>.</p></li>
<li><p><code>fecundity</code>: chains for fecundity parameters in <span class="math inline">\(\beta^x\)</span>.</p></li>
<li><p><code>dispersal parameter</code>: chains for dispersal parameter
<span class="math inline">\(u\)</span> showing prior
distribution.</p></li>
<li><p><code>variance sigma</code>: chains for error variance <span class="math inline">\(\sigma^2\)</span>, RMSPE, and deviance.</p></li>
<li><p><code>maturation, fecundity</code>: posterior 68% ( boxes ) and
95% ( whiskers ) for <span class="math inline">\(\beta^x\)</span> and
<span class="math inline">\(\beta^v\)</span>.</p></li>
<li><p><code>maturation, fecundity by diameter</code>: estimates ( dots
) with <span class="math inline">\(95%\)</span> predictive means for
latent states.</p></li>
<li><p><code>seed shadow</code>: with 90% predictive interval</p></li>
<li><p><code>prediction</code>: seed data predicted from estimates of
latent maturation and fecundity ( a ) and from parameter estimates. If
<code>trueValues</code> are supplied from <code>mastSim</code>, then
panel ( c ) includes true versus predicted values. There is an important
distinction between ( a ) and ( b )–good predictions in ( a ) indicate
that combinations of seed sources can be found to predict the seed data,
without necessarily meaning that the process model can predict
maturation and fecundity. Good predictions in ( b ) face the steeper
challenge that the process model must predict both maturation and
fecundity, which, in turn, predict seed rain.</p></li>
<li><p><code>parameter recovery</code>: if <code>trueValues</code> are
supplied from <code>mastSim</code>, then this plot is provided comparing
true and estimated values for <span class="math inline">\(\beta^v\)</span> and <span class="math inline">\(\beta^x\)</span>.</p></li>
<li><p><code>predicted fecundity, seed data</code>: maps show predicted
fecundity of trees ( sizes of green circles ) with seed data ( gray
squares ). If <code>predList</code> is supplied to <code>mastif</code>,
then the predicted seed surface is shown as shaded contours.</p></li>
<li><p><code>partial ACF</code>: autocorrelation function for fecundity
( estimated ) ( a ) and in seed counts ( observed ) ( b ).</p></li>
<li><p><code>tree correlation in time</code>: pairwise correlations
between trees on the same plot.</p></li>
</ul>
<p>The plots displayed by <code>mastPlot</code> include the MCMC chains
that are not yet converged. Again, I can restart where I left off by
using <code>output</code> as the <code>inputs</code> to
<code>mast</code>. In addition, I predict the seed surface from the
fitted model for a plot and year, as specified in
<code>predList</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>predList <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">mapMeters =</span> <span class="dv">3</span>, <span class="at">plots =</span> mapPlot, <span class="at">years =</span> mapYears )</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>output   <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> output, <span class="at">ng =</span> <span class="dv">2000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span></code></pre></div>
<p>To look closer at the predicted plot-year I generate a new map:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>mapPlot    <span class="ot">&lt;-</span> mapPlot</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>mapYears   <span class="ot">&lt;-</span> mapYears</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>treeScale  <span class="ot">&lt;-</span> <span class="fl">1.2</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>trapScale  <span class="ot">&lt;-</span> .<span class="dv">7</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>PREDICT    <span class="ot">&lt;-</span> T</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>scaleValue <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>plotScale  <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>COLORSCALE <span class="ot">&lt;-</span> T</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>LEGEND     <span class="ot">&lt;-</span> T</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mastMap</span>( output )</span></code></pre></div>
<p>The maps show seed counts ( squares ) and fecundity predictions (
circles ). For predicted plot years there is also shown a seed
prediction surface. The surface is seeds per m<span class="math inline">\(^2\)</span>.</p>
<p>Depending on the simulation, convergence may require more iterations.
The partial autocorrelation for years should be weak, because none are
simulated in <code>mastSim</code>. However, actual data will contain
autocorrelation. The fecundity-time correlations show modal values near
zero, because simulated data do not include individual covariance.
Positive spatial covariance is imposed by dispersal.</p>
<p>To send output to a single <code>Rmarkdown</code> file and
<code>html</code> or <code>pdf</code>, I use this:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>plotPars<span class="sc">$</span>RMD <span class="ot">&lt;-</span> <span class="st">&#39;pdf&#39;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output, plotPars )</span></code></pre></div>
<p>This option will generate a file <code>mastifOutput.Rmd</code>, which
can be opened in Rstudio, edited, and knitted to <code>pdf</code>
format. It contains data and posterior summaries generated by
<code>summary</code> and <code>mastPlot</code>. This pdf will not
include stand maps. Maps will be included in the <code>html</code>
version, obtained by setting <code>plotPars$RMD &lt;- &#39;html&#39;</code>.</p>
<p><br></p>
</div>
</div>
<div id="slow-convergence" class="section level2">
<h2><span style="color:teal">slow convergence?</span></h2>
<p>Seed shadow models confront convoluted likelihood surfaces, in the
sense that we expect local optima. These surfaces are hard to traverse
with MCMC ( and impossible with HMC ), because maturation status is a
binary state that must be proposed and accepted together with latent
fecundity. Posterior simulation can get bogged down when fecundity
estimates converge for a combination of mature and immature trees that
is locally but not globally optimal. Especially when there are more
trees of a species than there are seed traps, we expect many iterations
before the algorithm can ‘find’ the specific combination of trees that
together best describe the specific combination of seed counts in many
seed traps. Compounding the challenge is the fact that, because both
maturation and fecundity are latent variables for each individual, the
redistribution kernel must be constructed anew at each MCMC step. Yet,
analysis of simulated data shows that convergence to the correct
posterior distribution is common. It just may depend on finding
reasonable prior parameter values ( see below ) and long chains.</p>
<p>Examples in this vignette assign enough interations to show this
progress toward convergence may be happening, but sufficiently few to
avoid long waiting times. To evaluate convergence, consider the plots
for chains of <code>sigma</code> ( the residual variance <span class="math inline">\(\sigma\)</span> on log fecundity ), the
<code>rspse</code> ( the seed count residual ), and the
<code>deviance</code>. Finally, the plot of seed observed vs predicted
gives a sense of progress.</p>
<p>As demonstrated above, restart <code>mastif</code> with the fitted
object.</p>
<p><br></p>
</div>
<div id="multiple-seed-types-per-species" class="section level2">
<h2><span style="color:teal">multiple seed types per species</span></h2>
<p>Often a seed type could have come from trees of more than one
species. Seeds that are only identified to genus level include in
<code>seedNames</code> the <code>character</code> string
<code>UNKN</code>. In this simulation the three species
<code>pinuTaeda</code>, <code>pinuEchi</code>, and <code>pinuVirg</code>
contribute most seeds to the type <code>pinuUNKN</code>.
<strong>Important:</strong> there can be only one element in
<code>seedNames</code> containing the string <code>UNKN</code>.</p>
<p>Here are some inputs for the simulation:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>specNames <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;pinuTaeda&#39;</span>, <span class="st">&#39;pinuEchi&#39;</span>, <span class="st">&#39;pinuVirg&#39;</span> )</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>seedNames <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;pinuTaeda&#39;</span>, <span class="st">&#39;pinuEchi&#39;</span>, <span class="st">&#39;pinuVirg&#39;</span>, <span class="st">&#39;pinuUNKN&#39;</span> )</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>sim    <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">nyr=</span><span class="dv">4</span>, <span class="at">ntree=</span><span class="dv">25</span>, <span class="at">nplot=</span><span class="dv">10</span>, <span class="at">ntrap=</span><span class="dv">50</span>, <span class="at">specNames =</span> specNames, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seedNames =</span> seedNames )</span></code></pre></div>
<p>There is a <code>specNames</code>-by-<code>seedNames</code> matrix
<code>M</code> that is estimated as part of the posterior distribution.
For this example <code>seedNames</code> containing the string
<code>UNKN</code> refers to a seed type that cannot be differentiated
beyond the level of the genus <code>pinu</code>.</p>
<p>Here is the simulation with output objects with 2/3 of all seeds
identified only to genus level:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>inputs <span class="ot">&lt;-</span> <span class="fu">mastSim</span>( sim )        <span class="co"># simulate dispersal data</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>R      <span class="ot">&lt;-</span> inputs<span class="sc">$</span>trueValues<span class="sc">$</span>R   <span class="co"># species to seedNames probability matrix</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>( R, <span class="dv">2</span> )</span></code></pre></div>
<p>The matrix <code>M</code> stacks the length-<span class="math inline">\(M\)</span> vectors <span class="math inline">\(\mathbf{m}&#39;_s\)</span> discussed in Clark et
al. ( 2019 ) as a species-by-seed type matrix. There is a matrix for
each plot, here stacked as a single matrix. This is the matrix of values
used in simulation. <code>mastif</code> will estimate this matrix as
part of the posterior distribution.</p>
<p>Here is a model fit:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> inputs, <span class="at">ng =</span> <span class="dv">2000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> ) </span></code></pre></div>
<p>The model summary now includes estimates for the unknown
<code>M</code> as the “species to seed type matrix”:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( output )</span></code></pre></div>
<p>Output plots will include chains for estimates in <code>M</code>.
There will also be estimates for each species included in
<code>specNames</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>plotPars <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">trueValues =</span> inputs<span class="sc">$</span>trueValues, <span class="at">RMAT =</span> <span class="cn">TRUE</span> ) </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output, plotPars )</span></code></pre></div>
<p>The inverse of <span class="math inline">\(\mathbf{M}\)</span> is the
probability that an unknown seed of type <span class="math inline">\(m\)</span> was produced by a tree of species <span class="math inline">\(s\)</span>. These estimates are included in the
plot <code>Species to undiff seed</code>.</p>
<p>Again, the <code>.Rmd</code> file can be knitted to a
<code>pdf</code> file.</p>
<p>Here is a restart, now with <code>plots</code> and <code>years</code>
specified for prediction in <code>predList</code>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tab   <span class="ot">&lt;-</span> <span class="fu">with</span>( inputs<span class="sc">$</span>seedData, <span class="fu">table</span>( plot, year ) )</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>mapPlot <span class="ot">&lt;-</span> <span class="st">&#39;p1&#39;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>mapYears <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>( <span class="fu">colnames</span>( tab )[tab[<span class="dv">1</span>, ] <span class="sc">&gt;</span> <span class="dv">0</span>] )   <span class="co"># years for 1st plot</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>predList <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">plots =</span> mapPlot, <span class="at">years =</span> mapYears ) </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> output, <span class="at">ng =</span> <span class="dv">3000</span>, <span class="at">burnin =</span> <span class="dv">1500</span> )</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output, <span class="at">plotPars =</span> <span class="fu">list</span>( <span class="at">trueValues =</span> inputs<span class="sc">$</span>trueValues, <span class="at">MAPS =</span> <span class="cn">TRUE</span> )  )</span></code></pre></div>
<p>Chains for the <code>matrix M</code> will converge for plots where
there are sufficient trees and seeds to obtain an estimate. They will
not be identified on plots where one or the other are rare or
absent.</p>
<p>To map just the seed rain prediction maps, do this:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>PREDICT  <span class="ot">&lt;-</span> T</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>LEGEND   <span class="ot">&lt;-</span> T</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>mapPlot  <span class="ot">&lt;-</span> mapPlot</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>mapYears <span class="ot">&lt;-</span> mapYears</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mastMap</span>( output )</span></code></pre></div>
<p><br></p>
</div>
<div id="specnames-and-seednames" class="section level2">
<h2><span style="color:teal"><code>specNames</code> and
<code>seedNames</code></span></h2>
<p>In the many data sets where seeds of multiple species are not
differentiated the undifferentiated seed type occupies a column in
<code>seedData</code> having a column name that includes the string
<code>UNKN</code>. For a concrete example, if <code>specNames</code> on
a plot include trees in <code>treeData$species</code> with the
<code>specNames pinuTaed</code> and <code>pinuEchi</code>, then many
seeds might be indentified as <code>seedNames pinuUNKN</code>. In the
foregoing example, estimates of the <code>matrix M</code> reflect the
contributions of each species to the <code>UNKN</code> type. This could
be specified in several ways:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>specNames <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;pinuTaed&#39;</span>, <span class="st">&#39;pinuEchi&#39;</span> )</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#seeds not differentiated:</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>seedNames <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;pinuUNKN&#39;</span> ) </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">#one species sometimes differentiated:</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>seedNames <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;pinuTaed&#39;</span>, <span class="st">&#39;pinuUNKN&#39;</span> )    </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#both species sometimes differentiated:</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>seedNames <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;pinuTaed&#39;</span>, <span class="st">&#39;pinuEchi&#39;</span>, <span class="st">&#39;pinuUNKN&#39;</span> )</span></code></pre></div>
</div>
</div>
<div id="mastplot-written-to-files" class="section level1">
<h1><span style="color:brown"><code>mastPlot</code> written to
files</span></h1>
<p>The <code>function mastPlot</code> generates summary plots of
<code>output</code>. The user has access to all objects used to generate
these plots, as discussed in the previous section. By default plots in
<code>mastPlot</code> can be rendered to the console. If
<code>plotPars$SAVEPLOTS = T</code> is included in the
<code>list plotPars</code> passed to <code>mastPlot</code>, then each
plot is saved to a <code>.pdf</code> file. Plots can be consolidated
into a single <code>.Rmd</code> file, which can be knitted to
<code>.html</code> or <code>.pdf</code> with
<code>plotPars$RMD = html</code> or <code>plotPars$RMD = pdf</code>.</p>
<p><br></p>
</div>
<div id="my-data" class="section level1">
<h1><span style="color:darkgreen">my data</span></h1>
<p>For illustration I use sample data analyzed by Clark et al. ( 2013 ),
with data collection that has continued through 2017. It consists of
multiple years and sites.</p>
<p>Here I load data for species with a single recognized seed type,
<em>Liriodendron tulipifera</em>. Here is a map, with seed traps scaled
by seed counts, and trees scaled by diameter,</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>( repmis )</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/jimclarkatduke/mast/blob/master/liriodendronExample.rData?raw=True&quot;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>repmis<span class="sc">::</span><span class="fu">source_data</span>( d )</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>mapList <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">treeData =</span> treeData, <span class="at">seedData =</span> seedData, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">specNames =</span> specNames, <span class="at">seedNames =</span> seedNames, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xytree =</span> xytree, <span class="at">xytrap =</span> xytrap, <span class="at">mapPlot =</span> <span class="st">&#39;DUKE_BW&#39;</span>, </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mapYears =</span> <span class="dv">2011</span><span class="sc">:</span><span class="dv">2014</span>, <span class="at">treeSymbol =</span> treeData<span class="sc">$</span>diam, </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">treeScale =</span> .<span class="dv">7</span>, <span class="at">trapScale =</span> <span class="fl">1.5</span>, <span class="at">plotScale =</span> <span class="dv">2</span>, </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">SCALEBAR=</span>T, <span class="at">scaleValue=</span><span class="dv">50</span> )</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mastMap</span>( mapList )</span></code></pre></div>
<p>Here are a few lines of <code>treeData</code>, which has been trimmed
down to this single species,</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( treeData, <span class="dv">3</span> )</span></code></pre></div>
<p>Here are a few lines of <code>seedData</code>,</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>( seedData, <span class="dv">3</span> )</span></code></pre></div>
<div id="diameter-effect" class="section level2">
<h2><span style="color:teal">diameter effect</span></h2>
<p>Here I fit the model.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>formulaFec <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam )    <span class="co"># fecundity model</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>formulaRep <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam )    <span class="co"># maturation model</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>inputs   <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">specNames =</span> specNames, <span class="at">seedNames =</span> seedNames, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">treeData =</span> treeData, <span class="at">seedData =</span> seedData, <span class="at">xytree =</span> xytree, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xytrap =</span> xytrap )</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( inputs, formulaFec, formulaRep, <span class="at">ng =</span> <span class="dv">3000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span></code></pre></div>
<p>Following this short sequence, I fit a longer one and predict one of
the plots:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>predList <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">mapMeters =</span> <span class="dv">10</span>, <span class="at">plots =</span> <span class="st">&#39;DUKE_EW&#39;</span>, <span class="at">years =</span> <span class="dv">2010</span><span class="sc">:</span><span class="dv">2015</span> ) </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> output, <span class="at">ng =</span> <span class="dv">4000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span></code></pre></div>
<p>Here are some plots followed by comments on display panels. Notice
that when it progresses to the maps for plot DUKE_HW, they will include
the predicted seed shadows:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output )</span></code></pre></div>
<p>From <code>fecundity</code> chains, still more iterations are needed
for convergence.</p>
<p>From <code>seed shadow</code>, seed rain beneath a 30-cm diameter
tree averages near 0.2 seeds per m<span class="math inline">\(^2\)</span>.</p>
<p>Although a combination of maturation/fecundity can be found to
predict the seed data in <code>prediction</code> ( part a ), the process
model does not well predict the maturation/fecundity combination ( part
b ). In other words, the maturation/fecundity/dispersal aspect of the
model is effective, whereas the design does not yet include variables
that help explain maturation/fecundity.</p>
<p>From the many maps in <code>predicted fecundity, seed data</code>,
note that the <code>DUKE_EW</code> site includes prediction surfaces, as
specfied in <code>predList</code>.</p>
<p>Here is the summary:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( output )</span></code></pre></div>
<p>At this point in the the Gibbs sampler, the DIC and root mean square
prediction error are:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>fit</span></code></pre></div>
<p>As mentioned above, prediction scores for seed-trap observations are
based on the estimated fecundities <span class="math inline">\([\mathbf{y} | \phi, \rho]\)</span> as
<code>scoreStates</code> and on the estimated parameters <span class="math inline">\([\mathbf{y} | \phi, \rho][\phi, \rho|
\boldsymbol{\beta}^x, \boldsymbol{\beta}^w, \dots]\)</span> as
<code>predictScore</code>. The <code>TGc</code> and <code>TGd</code>
parameters are the affine-transformation parameters ( intercept, slope )
relating the predictive variance to the error variance ( Thorarinsdottir
and Gneiting, 2010 ).</p>
<p><br></p>
</div>
<div id="year-and-random-effects" class="section level2">
<h2><span style="color:teal">year and random effects</span></h2>
<p>Individual ( tree differences ) can be random and year-to-year
differences can be fixed; the latter are not ‘exchangeble’. In cases
where there are no predictors that explain variation among individuals
the <code>formula</code> can be limited to an intercept, using
<code>~ 1</code>. In this case, it can be valuable to estimate fecundity
even when there are no good predictors. For this intercept-only model,
random effects and/or year effects can allow for variation. Prior
parameter values are supplied as discussed below.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#group plots in regions for year effects</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> <span class="fu">rep</span>( <span class="st">&#39;sApps&#39;</span>, <span class="fu">nrow</span>( treeData ) )</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>region[ <span class="fu">as.character</span>( treeData<span class="sc">$</span>plot ) <span class="sc">==</span> <span class="st">&#39;DUKE_EW&#39;</span> ] <span class="ot">&lt;-</span> <span class="st">&#39;piedmont&#39;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>treeData<span class="sc">$</span>region <span class="ot">&lt;-</span> region</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>formulaFec   <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam )</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>formulaRep   <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam ) </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>yearEffect   <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">groups =</span> <span class="st">&#39;region&#39;</span> )</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>randomEffect <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">randGroups =</span> <span class="st">&#39;treeID&#39;</span>, <span class="at">formulaRan =</span> <span class="fu">as.formula</span>( <span class="sc">~</span> <span class="dv">1</span> ) )</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>inputs <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">specNames =</span> specNames, <span class="at">seedNames =</span> seedNames, </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">treeData =</span> treeData, <span class="at">seedData =</span> seedData, </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">xytree =</span> xytree, <span class="at">xytrap =</span> xytrap, </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">priorDist =</span> <span class="dv">28</span>, <span class="at">priorVDist =</span> <span class="dv">15</span>, <span class="at">maxDist =</span> <span class="dv">50</span>, <span class="at">minDist =</span> <span class="dv">15</span>, </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">minDiam =</span> <span class="dv">25</span>, <span class="at">maxF =</span> <span class="fl">1e+6</span>, </span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">randomEffect =</span> randomEffect, <span class="at">yearEffect =</span> yearEffect )</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( inputs, formulaFec, formulaRep, <span class="at">ng =</span> <span class="dv">2000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output )</span></code></pre></div>
<p>Without predictors, the fitted variation is coming from random
effects and year effects.</p>
<p>To substitute year effects for AR( <span class="math inline">\(p\)</span> ) effects, simply remove the argument
specification of <code>p</code> in the <code>yearEffect list</code>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>yearEffect   <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">groups =</span> <span class="fu">c</span>( <span class="st">&#39;species&#39;</span>, <span class="st">&#39;region&#39;</span> ) )   <span class="co"># year effects</span></span></code></pre></div>
<p><br></p>
</div>
<div id="prior-parameter-values" class="section level2">
<h2><span style="color:teal">prior parameter values</span></h2>
<p>In previous examples, the prior parameter values were past in the
<code>list inputs</code>. I can also specify prior values as inputs
through the <code>inputs$priorList</code> or
<code>inputs$priorTable</code> holding parameters named in Table 8.</p>
<p><strong>Table 8.</strong> Components of <code>inputs</code> with
default values.</p>
<table>
<colgroup>
<col width="25%" />
<col width="74%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">object</th>
<th align="left">explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><code>priorDist = 25</code></td>
<td align="left">prior mean dispersal distance parameter ( <span class="math inline">\(m\)</span> )</td>
</tr>
<tr class="even">
<td align="right"><code>priorVDist = 40</code></td>
<td align="left">prior variance dispersal parameter</td>
</tr>
<tr class="odd">
<td align="right"><code>minDist = 4</code></td>
<td align="left">minimum mean dispersal distance ( <span class="math inline">\(m\)</span> )</td>
</tr>
<tr class="even">
<td align="right"><code>maxDist = 70</code></td>
<td align="left">maximum mean dispersal distance ( <span class="math inline">\(m\)</span> )</td>
</tr>
<tr class="odd">
<td align="right"><code>maxF = 1e+8</code></td>
<td align="left">maximum fecundity ( seeds per tree-year )</td>
</tr>
<tr class="even">
<td align="right"><code>minDiam = 10</code></td>
<td align="left">minimum <code>diam</code> below which a tree can mature
( <span class="math inline">\(cm\)</span> )</td>
</tr>
<tr class="odd">
<td align="right"><code>maxDiam = 40</code></td>
<td align="left">maximum <code>diam</code> above which a tree can be
immature ( <span class="math inline">\(cm\)</span> )</td>
</tr>
<tr class="even">
<td align="right"><code>sigmaMu = 1</code></td>
<td align="left">prior mean residual variance <span class="math inline">\(\sigma^2\)</span></td>
</tr>
<tr class="odd">
<td align="right"><code>sigmaWt = sqrt( nrow( treeData ) )</code></td>
<td align="left">weight on prior mean ( no. of observations )</td>
</tr>
</tbody>
</table>
<p>The mean and variance of the dispersal kernel, <code>priorDist</code>
and <code>priorVDist</code>, refer to the dispersal parameter <span class="math inline">\(u\)</span>, transformed to the mean distance for
the dispersal kernel. The parameters <code>minDist</code> and
<code>maxDist</code> place minimum and maximum bounds on <span class="math inline">\(d\)</span>.<br />
Fecundity <span class="math inline">\(\phi\)</span> has a prior maximum
value of <code>maxF</code>.</p>
<p><code>minDiam</code> and <code>maxDiam</code> bound diameter ranges
where a tree of unknown maturation status can be mature or not. This
prior range is overridden by values in the <code>treeData$repr</code>
column that establish an observed maturation state for a tree-year ( 0 -
immature, 1 - mature ).</p>
<p>In general, large-seeded species, especially those that can be
dispersed by vertebrates, generate noisy seed-trap data, despite the
fact that the bulk of the counts still occur close to the parent, and
the mean dispersal distance is relatively low. Large-seeded species
produce few fruits/seeds. Long-distance dispersal cannot be estimated
from inventory plots, regardless of plot size, because the fit is
dominated by locally-derived seed. Consider values for maximum fecundity
as low as <code>maxF = 10000</code>, minimum dispersal
<code>minDist = 2</code>, and maximum dispersal
<code>maxDist = 12</code>. Recall that the latter values refer to the
dispersal kernel parameter value, not the maximum distance a seed can
travel, which is un-constrained.</p>
<p>Prior parameter values can be passed as a <code>list</code>,
e.g.,</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>priorList <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">minDiam =</span> <span class="dv">15</span>, <span class="at">maxDiam =</span> <span class="dv">60</span> )</span></code></pre></div>
<p>Alternatively, prior parameter values can be passed as a table, with
parameters for column names for <code>specNames</code> for rownames.
Here is a file holding parameter values and the
<code>function mastPriors</code> to obtain a table for several species
in the genus <span class="math inline">\(Pinus\)</span>,</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/jimclarkatduke/mast/blob/master/priorParametersPinus.csv?raw=True&quot;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>( d, <span class="at">destfile=</span><span class="st">&quot;priorParametersPinus.csv&quot;</span> )</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>specNames <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&quot;pinuEchi&quot;</span>, <span class="st">&quot;pinuRigi&quot;</span>, <span class="st">&quot;pinuStro&quot;</span>, <span class="st">&quot;pinuTaed&quot;</span>, <span class="st">&quot;pinuVirg&quot;</span> )</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>seedNames <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&quot;pinuEchi&quot;</span>, <span class="st">&quot;pinuRigi&quot;</span>, <span class="st">&quot;pinuStro&quot;</span>, <span class="st">&quot;pinuTaed&quot;</span>, <span class="st">&quot;pinuVirg&quot;</span>, <span class="st">&quot;pinuUNKN&quot;</span> )</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>priorTable <span class="ot">&lt;-</span> <span class="fu">mastPriors</span>( <span class="st">&quot;priorParametersPinus.csv&quot;</span>, specNames, </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">code =</span> <span class="st">&#39;code4&#39;</span>, <span class="at">genus =</span> <span class="st">&#39;pinus&#39;</span> )</span></code></pre></div>
<p>The argument <code>code = &#39;code8&#39;</code> specifies the column in
<code>priorParametersPinus.csv</code> holding the codes corresponding to
<code>specNames</code>. In <code>mastif</code> the format
<code>code4</code> means that names consist of the first 4 letters from
the genus and species, like this: <code>pinuTaed</code>. The
<code>genus</code> is provided to allow for genus-level parameters in
cases where priors for individual species have not been specified in
<code>priorParametersPinus.csv</code>.</p>
<p>For coefficients in fecundity, <code>betaPrior</code> specifies
predictor effects by sign. The use of prior distributions that are flat,
but truncated, is two-fold ( Clark et al. 2013 ). First, where prior
information exists, it often is limited to a range of values. For
regressions coefficients ( e.g., <span class="math inline">\(\boldsymbol{\beta}\)</span> ) we typically have a
prior belief about the sign of the effect ( positive or negative ), but
not its magnitude or appropriate weight. Second, within bounds placed by
the prior, the posterior has the shape of the likelihood, unaffected by
a prior weight. Prior weight is hard to specify sensibly for this
hierarchical, non-linear model.</p>
<p>Here is an example using <code>betaPrior</code> to specify a
quadratic diameter effect. First, here is a data set for
<em>Pinus</em>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/jimclarkatduke/mast/blob/master/pinusExample.rdata?raw=True&quot;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>repmis<span class="sc">::</span><span class="fu">source_data</span>( d )</span></code></pre></div>
<p>Here I specify formulas, prior bounds for <code>diam</code> (
quadratic ), and fit the model:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>formulaRep <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam )</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>formulaFec <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam <span class="sc">+</span> <span class="fu">I</span>( diam<span class="sc">^</span><span class="dv">2</span> ) )   </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>betaPrior  <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">pos =</span> <span class="st">&#39;diam&#39;</span>, <span class="at">neg =</span> <span class="st">&#39;I( diam^2 )&#39;</span> )</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                  </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>inputs <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">treeData =</span> treeData, <span class="at">seedData =</span> seedData, <span class="at">xytree =</span> xytree, </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">xytrap =</span> xytrap, <span class="at">specNames =</span> specNames, <span class="at">seedNames =</span> seedNames, </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">betaPrior =</span> betaPrior, <span class="at">priorTable =</span> priorTable, </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">seedTraits =</span> seedTraits )</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> inputs, formulaFec, formulaRep, </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ng =</span> <span class="dv">500</span>, <span class="at">burnin =</span> <span class="dv">200</span> )</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co"># restart</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( output, formulaFec, formulaRep, <span class="at">ng =</span> <span class="dv">5000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output )</span></code></pre></div>
<p>Here again, many of the seed ID maxtrix elements are well identified
( trace plots labeled “<code>M matrix plot</code>”, others are uncertain
due to small numbers of the different species that could contribute to a
seed type. These are presented as bar and whisker plots for elements of
matrix <span class="math inline">\(\mathbf{M}\)</span> ( fraction of
seed from a species that is counted as each seed type ) in the plot
labeled <code>species -&gt; seed type</code>. Bar plots show the
fraction of unknown seeds that derive from each species, labeled
<code>species -&gt; seed type</code>. The distribution of diameters in
the data will limit the ability to estimate its effect on maturation and
fecundity.</p>
<p>Note that the estimates for fecundity coefficients, <span class="math inline">\(\boldsymbol{\beta}^x\)</span>, are positive for
<code>diam</code> and negative for <code>diam^2</code>. If there is no
evidence in the data for a decrease <span class="math inline">\(\frac{\partial{\psi}}{\partial{diam}}\)</span>,
then the quadratic term is near zero. In this case, the predicted
fecundity in the plot labelled
<code>maturation, fecundity by diameter</code> will increase
exponentially.</p>
</div>
<div id="maturationfecundity-data-if-available" class="section level2">
<h2><span style="color:teal">maturation/fecundity data, if
available</span></h2>
<p>Most individuals produce no seed, due to resource limitation,
especially light, in crowded stands. As trees increase in size and
resource access they mature, and become capable of seed production.
Maturation is hard to observe, so it must be modelled. In our data sets,
maturation status is observed, but most values are NA; it is only
assigned if certain. A value of 1 means that reproduction is observed. A
value of 0 means that the entire crown is visible during the fruiting
season, and it is clear that no reproduction is present. Needless to
say, most observations from beneath closed canopies are NA. The
observations are entered in the column <code>repr</code> in the
<code>data.frame treeData</code>. Above I showed an example where
<code>minDiam</code> is set as a prior that trees of smaller diameters
are immature and <code>maxDiam</code> is the prior that trees above this
diameter are mature.</p>
<p><code>mastif</code> further admits estimates of cone production. The
column <code>treeData$cropCount</code> refers to the cones that will
open and contribute to trap counts in the year
<code>treeData$year</code>. There is another column
<code>treeData$cropFraction</code>, which refers to the fraction of the
tree canopy that is represented by the cone count. When crop counts are
used, a <code>matrix seedTraits</code> must be supplied with one row per
species and a column with seeds per fruit, cone, or pod. The rownames of
<code>seedTraits</code> are the <code>specNames</code>. The colname of
<code>seedTraits</code> with seeds per fruit is labeled
<code>seedsPerFruit</code>.</p>
</div>
<div id="when-trees-are-sampled-less-frequently-than-seeds" class="section level2">
<h2><span style="color:teal">when trees are sampled less frequently than
seeds</span></h2>
<p>Seed studies often include seed collections in years when trees are
not censused. For example, tree data might be collected every 2 to 5
years, whereas seed data are available as annual counts. In this case,
there there are years in <code>seedData$year</code> that are missing
from <code>treeData$year</code>. <code>mastif</code> needs a tree year
for each trap year. If tree data are missing from some trap years, I
need to constuct a complete <code>treeData data.frame</code> that
includes these missing years. This amended version of
<code>treeData</code> must be accessible to the user, to allow for the
addition of covariates such as weather variables, soil type, and so
forth.</p>
<p>The function <code>mastFillCensus</code> allows the user to access
the filled-in version of <code>treeData</code> that will be fitted by
<code>mastif</code>. <code>mastFillCensus</code> accepts the same
<code>list</code> of <code>inputs</code> that is passed to the function
<code>mastif</code>. The missing years are inserted for each tree with
interpolated diameters. The <code>list inputs</code> is returned with
objects updated to include the missing census years and modified
slightly for analysis by <code>mastif</code>.
<code>inputs$treeData</code> can now be annotated with the covariates
that will be included in the model. Here is the example from the
<code>help</code> file. First I read a file that has complete years, so
I randomly remove years:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># randomly remove years for this example:</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">sort</span>( <span class="fu">unique</span>( treeData<span class="sc">$</span>year ) )</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>sy    <span class="ot">&lt;-</span> <span class="fu">sample</span>( years, <span class="dv">5</span> )</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>treeData <span class="ot">&lt;-</span> treeData[treeData<span class="sc">$</span>year <span class="sc">%in%</span> sy, ]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>treeData[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ]</span></code></pre></div>
<p>Note the missing years, as is typical of mast data sets. Here is the
file after filling missing years:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>inputs   <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">specNames =</span> specNames, <span class="at">seedNames =</span> seedNames, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">treeData =</span> treeData, <span class="at">seedData =</span> seedData, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xytree =</span> xytree, <span class="at">xytrap =</span> xytrap, <span class="at">priorTable =</span> priorTable, </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seedTraits =</span> seedTraits )</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>inputs <span class="ot">&lt;-</span> <span class="fu">mastFillCensus</span>( inputs, <span class="at">beforeFirst=</span><span class="dv">10</span>, <span class="at">afterLast=</span><span class="dv">10</span> )</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>treeData[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ]</span></code></pre></div>
<p>The missing <code>plotYr</code> combinations in <code>treeData</code>
have been filled to match thos in <code>seedData</code>. Now columns can
be added to <code>inputs$treeData</code>, as needed in
<code>formulaFec</code> or <code>formulaRep</code>.</p>
<p>In cases where tree censuses start after seed trapping begins or tree
censuses end before seed trapping ends, it may be reasonable to assume
that the same trees are producing seed in those years pre-trapping or
post-trapping years. In these cases, <code>mastFillCensus</code> can
accommodate these early and/or late seed trap data by extrapolating
<code>treeData</code> <code>beforeFirst</code> years before seed
trapping begins or <code>afterLast</code> years after seed tapping
ends.</p>
</div>
<div id="adding-covariates" class="section level2">
<h2><span style="color:teal">adding covariates</span></h2>
<p>Continuing with the <span class="math inline">\(Pinus\)</span>
example, here I want to add covariates for missing years as needed for
an AR( <span class="math inline">\(p\)</span> ) model, in this example
<span class="math inline">\(p\)</span> = 4. First, consider the
tree-years included in this sample, before and after in-filling:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># original data</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>( treeData<span class="sc">$</span>year )</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># filled census</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>( inputs<span class="sc">$</span>treeData<span class="sc">$</span>year )</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>( seedData<span class="sc">$</span>year )</span></code></pre></div>
<p>Note that the infilled version of tree data in the
<code>list inputs</code> has the missing years, corresponding to those
included in <code>seedData</code>. Here I set up the year effects model
and infill to allow for <code>p = 3</code>,</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>inputs   <span class="ot">&lt;-</span> <span class="fu">mastFillCensus</span>( inputs, <span class="at">p =</span> p )</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>treeData <span class="ot">&lt;-</span> inputs<span class="sc">$</span>treeData</span></code></pre></div>
<p>Here are regions for random effects in the AR( 3 ) model:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;CWT&#39;</span>, <span class="st">&#39;DUKE&#39;</span>, <span class="st">&#39;HARV&#39;</span> )</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>treeData<span class="sc">$</span>region <span class="ot">&lt;-</span> <span class="st">&#39;SCBI&#39;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>( region ) ){</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  wj <span class="ot">&lt;-</span> <span class="fu">which</span>( <span class="fu">startsWith</span>( treeData<span class="sc">$</span>plot, region[j] ) )</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  treeData<span class="sc">$</span>region[wj] <span class="ot">&lt;-</span> region[j]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>treeData <span class="ot">&lt;-</span> treeData</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>yearEffect <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">groups =</span> <span class="fu">c</span>( <span class="st">&#39;species&#39;</span>, <span class="st">&#39;region&#39;</span> ), <span class="at">p =</span> p )</span></code></pre></div>
<p>I add the climatic deficit ( monthly precipitation minus PET ) as a
covariant. First, here is a data file,</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/jimclarkatduke/mast/blob/master/def.csv?raw=True&quot;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>( d, <span class="at">destfile=</span><span class="st">&quot;def.csv&quot;</span> )</span></code></pre></div>
<p>The format for the file <code>dev.csv</code> is <code>plot</code> by
<code>year_month</code>. I have saved it in my local directory. The
function <code>mastClimate</code> returns a <code>list</code> holding
three vectors, each having length equal to
<code>nrow( treeData )</code>. Here is an example for the cumulative
moisture deficit for the previous summer. I provide the file name, the
vector of plot names, the vector of previous years, and the months of
the year. To get the cumulative deficit, I use
<code>FUN = &#39;sum&#39;</code>:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>treeData <span class="ot">&lt;-</span> inputs<span class="sc">$</span>treeData</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>deficit  <span class="ot">&lt;-</span> <span class="fu">mastClimate</span>( <span class="at">file =</span> <span class="st">&#39;def.csv&#39;</span>, <span class="at">plots =</span> treeData<span class="sc">$</span>plot, </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">years =</span> treeData<span class="sc">$</span>year <span class="sc">-</span> <span class="dv">1</span>, <span class="at">months =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>, </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">FUN =</span> <span class="st">&#39;sum&#39;</span>, <span class="at">vname=</span><span class="st">&#39;def&#39;</span> )</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>treeData <span class="ot">&lt;-</span> <span class="fu">cbind</span>( treeData, deficit<span class="sc">$</span>x )</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( deficit )</span></code></pre></div>
<p>The first column in <code>deficit</code> is the variable itself for
each tree-year. The second column holds the site mean value for the
variable. The third column is the difference between the first two
columns All three can be useful covariates, each capturing different
effects ( Clark et al. 2014 ). I could append any or all of them as
columns to <code>treeData</code>.</p>
<p>Here is an example using minimum temperature of the preceeding
winter. I obtain the minimum with two calls to <code>mastClimate</code>,
first for Dec of the previous year (
<code>years = treeData$year - 1, months = 12</code> ), then from Jan,
Feb, Mar for the current year (
<code>years = treeData$year, months = 1:3</code> ). I then take the
minimum of the two values:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># include min winter temperature</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/jimclarkatduke/mast/blob/master/tmin.csv?raw=True&quot;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>( d, <span class="at">destfile=</span><span class="st">&quot;tmin.csv&quot;</span> )</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># minimum winter temperature December through March of previous winter</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">mastClimate</span>( <span class="at">file =</span> <span class="st">&#39;tmin.csv&#39;</span>, <span class="at">plots =</span> treeData<span class="sc">$</span>plot, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">years =</span> treeData<span class="sc">$</span>year <span class="sc">-</span> <span class="dv">1</span>, <span class="at">months =</span> <span class="dv">12</span>, <span class="at">FUN =</span> <span class="st">&#39;min&#39;</span>, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">vname =</span> <span class="st">&#39;tmin&#39;</span> )</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> <span class="fu">mastClimate</span>( <span class="at">file =</span> <span class="st">&#39;tmin.csv&#39;</span>, <span class="at">plots =</span> treeData<span class="sc">$</span>plot, </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">years =</span> treeData<span class="sc">$</span>year, <span class="at">months =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">FUN =</span> <span class="st">&#39;min&#39;</span>, </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">vname =</span> <span class="st">&#39;tmin&#39;</span> )</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>tmin <span class="ot">&lt;-</span> <span class="fu">apply</span>( <span class="fu">cbind</span>( t1<span class="sc">$</span>x[, <span class="dv">1</span>], t2<span class="sc">$</span>x[, <span class="dv">1</span>] ), <span class="dv">1</span>, min )</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>treeData<span class="sc">$</span>tminDecJanFebMar <span class="ot">&lt;-</span> tmin</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>treeData <span class="ot">&lt;-</span> treeData</span></code></pre></div>
<p>Here is a model using several of these variables:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>formulaRep <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam )</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>formulaFec <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam <span class="sc">+</span> defJunJulAugAnom <span class="sc">+</span> tminDecJanFebMar )   </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>yearEffect <span class="ot">&lt;-</span> yearEffect</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> inputs, formulaFec, formulaRep, <span class="at">ng =</span> <span class="dv">2500</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span></code></pre></div>
<p>Data for future years can be a scenario, based on assumptions of
status quo in the mean and variance, an assumed rate of climate change,
and so on.</p>
<p><br></p>
</div>
</div>
<div id="flexibility" class="section level1">
<h1><span style="color:darkgreen">flexibility</span></h1>
<p>Seed production is volatile, with order of magnitude variation from
year-to-year. There is synchronicity among individuals of the same
species, the “masting” phenomenon. There are large difference between
individuals, that are not explained by environmental variables. In this
section I discuss extensions to random effects, year effects, lag
effects, and fitting multiple species having seed types that are not
always identifiable to species.</p>
<div id="random-individual-effects" class="section level2">
<h2><span style="color:teal">random individual effects</span></h2>
<p>Random individual effects currently can include random intercepts for
the fecundities of each individual tree that is imputed to be in the
mature state for at least 3 years. [There are no random effects on
maturation, because they would be hard to identify from seed trap data
for this binary response.]</p>
<p>I include in the <code>inputs list</code> the
<code>list randomEffect</code>, which includes the column name for the
random group. Typically this would be a unique identifier for a tree
within a plot, e.g., <code>randomEffect$randGroups = &#39;tree&#39;</code>.
However, <code>randGroups</code> could be the plot name. This column is
interpreted as a <code>factor</code>, each level being a group. Random
effects will not be fitted on individuals that are in the mature state
less than 3 years.</p>
<p>The <code>formulaRan</code> is the random effects model. Because
individual time series tend to short, it is currently implemented only
for intercepts. Here is a fit with random effects.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>formulaFec <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam )    <span class="co"># fecundity model</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>formulaRep <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam )    <span class="co"># maturation model </span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>randomEffect <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">randGroups =</span> <span class="st">&#39;tree&#39;</span>, <span class="at">formulaRan =</span> <span class="fu">as.formula</span>( <span class="sc">~</span> <span class="dv">1</span> ) )</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> inputs, formulaFec, formulaRep, <span class="at">ng =</span> <span class="dv">2000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span></code></pre></div>
<p>Here is a restart:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> output, <span class="at">ng =</span> <span class="dv">4000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output )</span></code></pre></div>
<p>There is a new panel for <code>fixed plus random effects</code>,
showing the individual combinations of intercepts.</p>
<ul>
<li>the <code>prediction</code> panel ( b ) shows some improvement,
indicating that even with random effects, diameter struggles to predict
maturation/fecundity.</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>fit</span></code></pre></div>
</div>
<div id="random-groups-for-years-and-lags" class="section level2">
<h2><span style="color:teal">random groups for years and
lags</span></h2>
<p>As discussed previously, the model admits year effects and lag
effects, the latter as an AR( <span class="math inline">\(p\)</span> )
model. Year effects assign a coefficient to each year <span class="math inline">\(t = [1, \dots, T_j]\)</span>. Lag effects assign a
coefficient to each of <span class="math inline">\(j \in \{1, \dots,
p\}\)</span> plags, where the maximum lag <span class="math inline">\(p\)</span> should be substantially less than the
number of years in the study. Year effects can be organized in random
groups. Specification of random groups is done in the same way for year
effects and for lag effects.</p>
<p>I define random groups for year and lag effects by species, by plots,
or both. When there are multiple species that contribute to the modeled
seed types, I expect the year effects to depend on which species is
actually producing the seed. When there are multiple plots sufficiently
distant from one another, I might allow for the fact that year effects
or lag effects differ by group; <code>yearEffect$groups</code> allows
that they need not mast in the same years. In the example below, I’ll
use the term <em>region</em> for plots in the same plotGroup.</p>
<p>Here is a breakdown for this data set by region:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>( treeData, <span class="fu">colSums</span>( <span class="fu">table</span>( plot, region ) ) )</span></code></pre></div>
<p>Here are year effects structured by random groups of plots, given by
the column <code>region</code> in <code>treeData</code>:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>yearEffect <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">groups =</span> <span class="fu">c</span>(<span class="st">&#39;species&#39;</span>, <span class="st">&#39;region&#39;</span> ) )</span></code></pre></div>
<p>This option will fit a year effect for both provinces and years
having sufficient individuals estimated to be in the mature state. Here
is the model with random year effects,</p>
<p><span class="math display">\[\log \psi_{ij, t} \sim N \left(
\mathbf{x}&#39;_{ij, t} \mathbf{\beta}^x + \gamma_t + \gamma_{g[i], t},
\sigma^2 \right )\]</span> where the year effect <span class="math inline">\(\gamma_{g[i], t}\)</span> is shared by trees in
all plots defined by <code>yearEffect$province</code>, <span class="math inline">\(ij \in g\)</span>. Year effects are sampled
directly from conditional posteriors.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>treeData      <span class="ot">&lt;-</span> treeData </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>randomEffect  <span class="ot">&lt;-</span> randomEffect</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>inputs<span class="sc">$</span>yearEffect    <span class="ot">&lt;-</span> yearEffect</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> inputs, formulaFec, formulaRep, <span class="at">ng =</span> <span class="dv">2500</span>, <span class="at">burnin =</span> <span class="dv">500</span> )</span></code></pre></div>
<p>Here is a restart, with predictions for one of the plots:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>predList <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">mapMeters =</span> <span class="dv">10</span>, <span class="at">plots =</span> <span class="st">&#39;DUKE_BW&#39;</span>, <span class="at">years =</span> <span class="dv">1998</span><span class="sc">:</span><span class="dv">2014</span> ) </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>predList <span class="ot">&lt;-</span> predList</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> output, <span class="at">ng =</span> <span class="dv">3000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output )</span></code></pre></div>
<p>Note that still more iterations are needed for convergence. Here are
some comments on <code>mastPlot</code>:</p>
<ul>
<li><p>In the <code>dispersal parameter u</code> panel there are now
year effects plotted for the two random groups <code>mtn</code> and
<code>piedmont</code>.</p></li>
<li><p>The subsequent panel <code>dispersal mean and variance</code>
shows the mean and variance of random effects</p></li>
<li><p>There is a <code>dispersal by group</code> panel showing
posterior estimate for the two random groups, with scales for the
parameter <span class="math inline">\(u\)</span> on the left ( m<span class="math inline">\(^2\)</span> ) and mean parameter <span class="math inline">\(d\)</span> on the right ( m ).</p></li>
<li><p>There has been some improvement in the <code>prediction</code>,
panel ( b ).</p></li>
<li><p>The <code>predicted fecundity, seed data</code> maps for the plot
<code>DUKE_BW</code> show seed prediction surfaces.</p></li>
<li><p>The <code>year effect groups</code> shows year effects for random
groups in <code>treeData$region</code>.</p></li>
<li><p><code>partial ACF</code> shows partial autocorrelation by species
and plot.</p></li>
</ul>
<p><br></p>
</div>
<div id="random-effects-when-there-are-multiple-species" class="section level2">
<h2><span style="color:teal">random effects when there are multiple
species</span></h2>
<p>Most data sets have multiple seed types that complicate estimation of
mast production by each species. This example considers <em>Pinus</em>
spp, seeds of which cannot be confidently assigned to species. Here I
load the data and generate a sample of maps from several years,
including all species and seed types.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/jimclarkatduke/mast/blob/master/pinusExample.rdata?raw=True&quot;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>repmis<span class="sc">::</span><span class="fu">source_data</span>( d )</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>mapList <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">treeData =</span> treeData, <span class="at">seedData =</span> seedData, </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">specNames =</span> specNames, <span class="at">seedNames =</span> seedNames, </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xytree =</span> xytree, <span class="at">xytrap =</span> xytrap, <span class="at">mapPlot =</span> <span class="st">&#39;DUKE_EW&#39;</span>, </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mapYears =</span> <span class="fu">c</span>( <span class="dv">2007</span><span class="sc">:</span><span class="dv">2010</span> ), <span class="at">treeSymbol =</span> treeData<span class="sc">$</span>diam, </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">treeScale =</span> .<span class="dv">6</span>, <span class="at">trapScale=</span><span class="fl">1.4</span>, </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">plotScale =</span> <span class="fl">1.2</span>, <span class="at">LEGEND=</span>T )</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mastMap</span>( mapList )</span></code></pre></div>
<p>Note the tendency for high seed accumulation ( large green squares )
near dense, large trees ( large brown circles ).</p>
<p>In this example, I again model seed production as a function of log
diameter, <code>diam</code>, now for multiple species and seed types.
This is an AR( p ) model, because I include the number of lag terms
<code>yearEffect$p = 5</code>,</p>
<p><span class="math display">\[\log \psi_{ij, t} \sim N \left(
\mathbf{x}&#39;_{ij, t} \mathbf{\beta}^x + \sum^p_{l=1} ( \alpha_l +
\alpha_{g[i], l} ) \psi_{ij, t-l}, \sigma^2 \right )\]</span> Only years
<span class="math inline">\(p &lt; t \le T_i\)</span> are used for
fitting. Samples are drawn directly from the conditional posterior
distribution.</p>
<p>In the table printed at the outset are trees by plot and year, i.e.,
the <code>groups</code> assigned in <code>inputs$yearEffect</code>. The
zeros indicate either absence of trees or that no plots were sampled in
those years. ( These are not the same thing, <code>mastif</code> knows
the difference ).</p>
<p>In the code below I specify formulas, AR( <span class="math inline">\(p\)</span> ), and random effects, and some prior
values. Due to the large number of trees, convergence is slow. Because I
do not assume that trees of different species necessarily mast in the
same years, I allow them to differ through random groups on the AR(
<span class="math inline">\(p\)</span> ) terms.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>formulaFec <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam )   <span class="co"># fecundity model</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>formulaRep <span class="ot">&lt;-</span> <span class="fu">as.formula</span>( <span class="sc">~</span> diam )   <span class="co"># maturation model</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>yearEffect   <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">groups =</span> <span class="st">&#39;species&#39;</span>, <span class="at">p =</span> <span class="dv">4</span> )   <span class="co"># AR( 4 )</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>randomEffect <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">randGroups =</span> <span class="st">&#39;tree&#39;</span>, </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">formulaRan =</span> <span class="fu">as.formula</span>( <span class="sc">~</span> <span class="dv">1</span> ) )</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>inputs   <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">specNames =</span> specNames, <span class="at">seedNames =</span> seedNames, </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">treeData =</span> treeData, <span class="at">seedData =</span> seedData, </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">yearEffect =</span> yearEffect, </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">randomEffect =</span> randomEffect,</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xytree =</span> xytree, <span class="at">xytrap =</span> xytrap, <span class="at">priorDist =</span> <span class="dv">20</span>, </span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">priorVDist =</span> <span class="dv">5</span>, <span class="at">minDist =</span> <span class="dv">15</span>, <span class="at">maxDist =</span> <span class="dv">30</span>, </span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">minDiam =</span> <span class="dv">12</span>, <span class="at">maxDiam =</span> <span class="dv">40</span>, </span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">maxF =</span> <span class="fl">1e+6</span>, <span class="at">seedTraits =</span> seedTraits )</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> inputs, formulaFec, formulaRep, <span class="at">ng =</span> <span class="dv">500</span>, <span class="at">burnin =</span> <span class="dv">100</span> )</span></code></pre></div>
<p>Here is a restart:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> output, <span class="at">ng =</span> <span class="dv">3000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output, <span class="at">plotPars =</span> plotPars )</span></code></pre></div>
<p>Again, convergence will require more iterations. The AR( <span class="math inline">\(p\)</span> ) coefficients in the
<code>lag effect group</code> panel shows the coefficients by random
group. They are also shown in a separate panel, with each group plotted
separately. In the <code>ACF eigenvalues</code> panel are shown the
eigenvalues for AR lag coefficients on the real ( horizontal ) and
imaginary ( vertical ) scales with the unit circle, within which
oscillations are damped. The imaginary axis describes oscillations.</p>
<p>Here’s a restart with predictions:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;DUKE_EW&#39;</span>, <span class="st">&#39;CWT_118&#39;</span> )</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">1980</span><span class="sc">:</span><span class="dv">2025</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>predList <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">mapMeters =</span> <span class="dv">10</span>, <span class="at">plots =</span> plots, <span class="at">years =</span> years ) </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">mastif</span>( <span class="at">inputs =</span> output, <span class="at">ng =</span> <span class="dv">3000</span>, <span class="at">burnin =</span> <span class="dv">1000</span> )</span></code></pre></div>
<p>and updated plots:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mastPlot</span>( output, )</span></code></pre></div>
<p>Note that convergence requires additional iterations ( larger
<code>ng</code> ). The predictions of seed production will progressively
improve with convergence.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>mapList <span class="ot">&lt;-</span> output</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>mapPlot <span class="ot">&lt;-</span> <span class="st">&#39;DUKE_EW&#39;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>mapYears <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">2011</span><span class="sc">:</span><span class="dv">2012</span> )</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>PREDICT <span class="ot">&lt;-</span> T</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>treeScale <span class="ot">&lt;-</span> .<span class="dv">5</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>trapScale <span class="ot">&lt;-</span> .<span class="dv">8</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>LEGEND <span class="ot">&lt;-</span> T</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>scaleValue <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>plotScale  <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>COLORSCALE <span class="ot">&lt;-</span> T</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>mfrow <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">1</span> )</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mastMap</span>( mapList )</span></code></pre></div>
<p>Or a larger view of a single map:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>mapPlot <span class="ot">&lt;-</span> <span class="st">&#39;CWT_118&#39;</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>mapYears <span class="ot">&lt;-</span> <span class="dv">2015</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>PREDICT <span class="ot">&lt;-</span> T</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>treeScale <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>trapScale <span class="ot">&lt;-</span> .<span class="dv">8</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>LEGEND <span class="ot">&lt;-</span> T</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>scaleValue <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>plotScale <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>COLORSCALE <span class="ot">&lt;-</span> T</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>mapList<span class="sc">$</span>mfrow <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">1</span> )</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mastMap</span>( mapList )</span></code></pre></div>
<p>Here is a summary of parameter estimates:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( output )</span></code></pre></div>
</div>
</div>
<div id="convergence" class="section level1">
<h1><span style="color:darkgreen">convergence</span></h1>
<p>R code is highly vectorized. Unavoidable loops are written in C++ and
exploit the C++ library <code>Armadillo</code>, available through
<code>RcppArmadillo</code>. Alternating with Metropolis are Hamiltonian
MC steps to encourage large movements.</p>
<p>Despite extensive vectorization and C++ for cases where loops are
unavoidable, convergence can be slow. A collection of plots inventoried
over dozens of years can generate in excess of <span class="math inline">\(10^6\)</span> tree-year observations and <span class="math inline">\(10^4\)</span> trap year observations. There is no
escaping the requirement of large numbers of indirectly sampled latent
variables. If random effects are included, there are ( obviously ) as
many random groups as there are trees. All tree fecundities must be
imputed.</p>
</div>
<div id="time-series-volatility-and-periodicity" class="section level1">
<h1><span style="color:darkgreen">time series: volatility and
periodicity</span></h1>
<p>Qui et al. (2023) introduced volatility and period to characterize
and compare masting behavior between trees and species. The tradition
coefficient of variation (CV) ignores the time-dependence in
quasi-periodic seed production. To avoid confusion with indices based on
variance, they introduced the term <em>volatility</em> as the
period-weighted spectral density, to allow for the fact that long
intervals are especially important for masting causes and effects on
consumers. In addition to this period-weighting of spectral variance
within a series (a tree), fecundity-weighting is important at the
population scale, because the highly productive individuals dominate
masting effects. Within this framework, <em>periodicity</em> extracts
the period (in years) that is likewise weighted to emphasize variance
concentrated at long intervals within trees and fecundity differences
between trees.</p>
<p>The block of code that follows loads output from some trees in the
genus <em>Abies</em> from western North America. Specifically, the
estimates for fecundity by tree-year come from the object
<code>output$prediction$fecPred</code>. it uses the function
<code>mastVolatility</code> to compile volatility and periodicity on
each tree and display summaries by ecoregion-species as density plots
and as distributions of mean period estimates.</p>
<p>First, several more functions:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>getColor <span class="ot">&lt;-</span> <span class="cf">function</span>( col, trans ){                  <span class="co"># transparent colors</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">col2rgb</span>( col )</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rgb</span>( tmp[ <span class="dv">1</span>, ], tmp[ <span class="dv">2</span>, ], tmp[ <span class="dv">3</span>, ], <span class="at">maxColorValue =</span> <span class="dv">255</span>, </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="dv">255</span><span class="sc">*</span>trans, <span class="at">names =</span> <span class="fu">paste</span>( col, trans, <span class="at">sep =</span> <span class="st">&#39;_&#39;</span> ) )</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>getPlotLayout <span class="ot">&lt;-</span> <span class="cf">function</span>( np, <span class="at">WIDE =</span> <span class="cn">TRUE</span> ){</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># np - no. plots</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">==</span> <span class="dv">1</span> )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">1</span> ), <span class="at">left =</span> <span class="dv">1</span>, <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span> ) ) )</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">==</span> <span class="dv">2</span> ){</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( WIDE )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span> ), <span class="at">left =</span> <span class="dv">1</span>, <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span> ) ) )</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">1</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span> ), <span class="at">bottom =</span> <span class="dv">2</span> ) )</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">==</span> <span class="dv">3</span> ){</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( WIDE )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">3</span> ), <span class="at">left =</span> <span class="dv">1</span>, <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> ) ) )</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">3</span>, <span class="dv">1</span> ), <span class="at">left =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">bottom =</span> <span class="dv">3</span> ) )</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">&lt;=</span> <span class="dv">4</span> )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">2</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">3</span> ), <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span> ) ) )</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">&lt;=</span> <span class="dv">6</span> ){</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( WIDE )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">2</span>, <span class="dv">3</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">4</span> ), <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span> ) ) )</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">3</span>, <span class="dv">2</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span> ), <span class="at">bottom =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span> ) )</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">&lt;=</span> <span class="dv">9</span> )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">3</span>, <span class="dv">3</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span> ), <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span> ) ) )</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">&lt;=</span> <span class="dv">12</span> ){</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( WIDE )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">3</span>, <span class="dv">4</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span> ), <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">9</span><span class="sc">:</span><span class="dv">12</span> ) ) )</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">4</span>, <span class="dv">3</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span> ), <span class="at">bottom =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">12</span> ) )</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">&lt;=</span> <span class="dv">16</span> )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">4</span>, <span class="dv">4</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">13</span> ), </span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">13</span><span class="sc">:</span><span class="dv">16</span> ) ) )</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">&lt;=</span> <span class="dv">20</span> ){</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( WIDE )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">4</span>, <span class="dv">5</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">15</span> ), </span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">15</span><span class="sc">:</span><span class="dv">20</span> ) ) )</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">5</span>, <span class="dv">4</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">13</span> ), <span class="at">bottom =</span> <span class="dv">17</span><span class="sc">:</span><span class="dv">20</span> ) )</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">&lt;=</span> <span class="dv">25</span> )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">5</span>, <span class="dv">5</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">15</span>, <span class="dv">20</span> ), </span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">20</span><span class="sc">:</span><span class="dv">25</span> ) ) )</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">&lt;=</span> <span class="dv">25</span> ){</span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( WIDE )<span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">5</span>, <span class="dv">6</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span> ), </span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>                            <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">25</span><span class="sc">:</span><span class="dv">30</span> ) ) )</span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">6</span>, <span class="dv">5</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">21</span>, <span class="dv">26</span> ), <span class="at">bottom =</span> <span class="dv">26</span><span class="sc">:</span><span class="dv">30</span> ) )</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( np <span class="sc">&lt;=</span> <span class="dv">36</span> ){</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">6</span>, <span class="dv">6</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">13</span>, <span class="dv">19</span>, <span class="dv">25</span>, <span class="dv">31</span> ), <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">31</span><span class="sc">:</span><span class="dv">36</span> ) ) )</span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">list</span>( <span class="at">mfrow =</span> <span class="fu">c</span>( <span class="dv">7</span>, <span class="dv">6</span> ), <span class="at">left =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">7</span>, <span class="dv">13</span>, <span class="dv">19</span>, <span class="dv">25</span>, <span class="dv">31</span>, <span class="dv">37</span> ), <span class="at">bottom =</span> <span class="fu">c</span>( <span class="dv">37</span><span class="sc">:</span><span class="dv">42</span> ) ) )</span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a>  plotFec <span class="ot">&lt;-</span> <span class="cf">function</span>( fec, <span class="at">groups =</span> <span class="cn">NULL</span>, <span class="at">LOG =</span> F ){</span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( <span class="fu">is.null</span>(groups) ){</span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a>      groupID <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(fec) )</span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a>      ngroup  <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a>      group   <span class="ot">&lt;-</span> fec[, groups]</span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a>      groups  <span class="ot">&lt;-</span> <span class="fu">sort</span>( <span class="fu">unique</span>( group ) )</span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a>      groupID <span class="ot">&lt;-</span> <span class="fu">match</span>( group, groups )</span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>      ngroup  <span class="ot">&lt;-</span> <span class="fu">length</span>( groups )</span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( LOG )fec<span class="sc">$</span>fecEstMu <span class="ot">&lt;-</span> <span class="fu">log10</span>(fec<span class="sc">$</span>fecEstMu)</span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a>    xlim  <span class="ot">&lt;-</span> <span class="fu">range</span>( fec<span class="sc">$</span>year )</span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a>    ylim  <span class="ot">&lt;-</span> <span class="fu">range</span>( fec<span class="sc">$</span>fecEstMu, <span class="at">na.rm =</span> T )</span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a>    mfrow <span class="ot">&lt;-</span> <span class="fu">getPlotLayout</span>(ngroup)</span>
<span id="cb65-68"><a href="#cb65-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-69"><a href="#cb65-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>( <span class="at">mfrow =</span> mfrow<span class="sc">$</span>mfrow, <span class="at">bty =</span> <span class="st">&#39;n&#39;</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">omi =</span> <span class="fu">c</span>( .<span class="dv">5</span>, .<span class="dv">5</span>, .<span class="dv">2</span>, .<span class="dv">2</span>) )</span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>( k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ngroup ){</span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-73"><a href="#cb65-73" aria-hidden="true" tabindex="-1"></a>      fk    <span class="ot">&lt;-</span> fec[ groupID <span class="sc">==</span> k, ]</span>
<span id="cb65-74"><a href="#cb65-74" aria-hidden="true" tabindex="-1"></a>      tree  <span class="ot">&lt;-</span> fk<span class="sc">$</span>treeID</span>
<span id="cb65-75"><a href="#cb65-75" aria-hidden="true" tabindex="-1"></a>      trees <span class="ot">&lt;-</span> <span class="fu">sort</span>( <span class="fu">unique</span>( tree ) )</span>
<span id="cb65-76"><a href="#cb65-76" aria-hidden="true" tabindex="-1"></a>      ntree <span class="ot">&lt;-</span> <span class="fu">length</span>( trees )</span>
<span id="cb65-77"><a href="#cb65-77" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-78"><a href="#cb65-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>( <span class="cn">NA</span>, <span class="at">xlim =</span> xlim, <span class="at">ylim =</span> ylim, <span class="at">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;&#39;</span> )</span>
<span id="cb65-79"><a href="#cb65-79" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb65-80"><a href="#cb65-80" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ntree){</span>
<span id="cb65-81"><a href="#cb65-81" aria-hidden="true" tabindex="-1"></a>        fj <span class="ot">&lt;-</span> fk[ tree <span class="sc">==</span> trees[j], ]</span>
<span id="cb65-82"><a href="#cb65-82" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lines</span>( fj<span class="sc">$</span>year, fj<span class="sc">$</span>fecEstMu, <span class="at">lwd =</span> <span class="dv">1</span> )</span>
<span id="cb65-83"><a href="#cb65-83" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb65-84"><a href="#cb65-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">title</span>( groups[k] )</span>
<span id="cb65-85"><a href="#cb65-85" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb65-86"><a href="#cb65-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mtext</span>( <span class="st">&#39;Year&#39;</span>, <span class="dv">1</span>, <span class="at">outer =</span> T, <span class="at">cex =</span> <span class="fl">1.2</span> )</span>
<span id="cb65-87"><a href="#cb65-87" aria-hidden="true" tabindex="-1"></a>    ytext <span class="ot">&lt;-</span> <span class="st">&#39;Seeds per tree&#39;</span></span>
<span id="cb65-88"><a href="#cb65-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>( LOG ) ytext <span class="ot">&lt;-</span> <span class="st">&#39;Seeds per tree (log_10)&#39;</span></span>
<span id="cb65-89"><a href="#cb65-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mtext</span>( ytext, <span class="dv">2</span>, <span class="at">outer =</span> T, <span class="at">cex =</span> <span class="fl">1.2</span> )</span>
<span id="cb65-90"><a href="#cb65-90" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p>Here is the volatility:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/jimclarkatduke/mast/blob/master/outputAbies.rdata?raw=True&quot;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>repmis<span class="sc">::</span><span class="fu">source_data</span>( d )</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>specs   <span class="ot">&lt;-</span> <span class="fu">sort</span>( <span class="fu">unique</span>( fecPred<span class="sc">$</span>species ) )     <span class="co"># accumulate period estimates</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>yseq    <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="dv">0</span>, <span class="dv">10</span>, <span class="at">length =</span> <span class="dv">100</span> )       </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>intVal  <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="dv">0</span>, <span class="fu">length</span>(specs), <span class="dv">100</span> )</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>weight  <span class="ot">&lt;-</span> intVal</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>( intVal ) <span class="ot">&lt;-</span> specs</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>plotSpecs <span class="ot">&lt;-</span> <span class="fu">sort</span>( <span class="fu">unique</span>( fecPred<span class="sc">$</span>plotSpec ) )  <span class="co"># label trees in a plot-species group</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># time series for one species:</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plotFec</span>( <span class="at">fec =</span> fecPred[ fecPred<span class="sc">$</span>species <span class="sc">==</span> <span class="st">&#39;abiesGrandis&#39;</span>, ], <span class="at">groups =</span> <span class="st">&#39;species&#39;</span>, <span class="at">LOG =</span> T )</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>( <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">bty =</span> <span class="st">&#39;n&#39;</span>, <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">omi =</span> <span class="fu">c</span>(.<span class="dv">5</span>,.<span class="dv">1</span>,.<span class="dv">1</span>,.<span class="dv">1</span>) )</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="cn">NA</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">01</span>, <span class="dv">1</span>), <span class="at">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Density/nyr&#39;</span>, <span class="at">log =</span> <span class="st">&#39;xy&#39;</span>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(plotSpecs) ){</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  wi  <span class="ot">&lt;-</span> <span class="fu">which</span>( fecPred<span class="sc">$</span>plotSpec <span class="sc">==</span> plotSpecs[i] ) <span class="co"># tree-years in group</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>  ci  <span class="ot">&lt;-</span> fecPred<span class="sc">$</span>species[wi[<span class="dv">1</span>]]</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  col <span class="ot">&lt;-</span> <span class="fu">match</span>( ci, specs )                        <span class="co"># color by species</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> <span class="fu">mastVolatility</span>( <span class="at">treeID =</span> fecPred<span class="sc">$</span>treeID[wi], <span class="at">year =</span> fecPred<span class="sc">$</span>year[wi], </span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fec =</span> fecPred<span class="sc">$</span>fecEstMu[wi] )</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">is.null</span>(tmp) )<span class="cf">next</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>  intVal[ col, ] <span class="ot">&lt;-</span> intVal[ col, ] <span class="sc">+</span> <span class="fu">dnorm</span>( yseq, tmp<span class="sc">$</span>stats[<span class="st">&#39;Period&#39;</span>, <span class="dv">1</span>], tmp<span class="sc">$</span>stats[<span class="st">&#39;Period&#39;</span>, <span class="dv">2</span>] )</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>  weight[ col, ] <span class="ot">&lt;-</span> weight[ col, ] <span class="sc">+</span> <span class="fu">length</span>( wi )</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># density +/- 1 SD</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>  dens <span class="ot">&lt;-</span> tmp<span class="sc">$</span>statsDensity</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( dens[ <span class="st">&#39;Period&#39;</span>, ], dens[ <span class="st">&#39;Mean&#39;</span>, ], <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">getColor</span>( col, .<span class="dv">4</span>) )</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( dens[ <span class="st">&#39;Period&#39;</span>, ], dens[ <span class="st">&#39;Mean&#39;</span>, ] <span class="sc">-</span> dens[ <span class="st">&#39;SD&#39;</span>, ], <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">getColor</span>( col, .<span class="dv">4</span>) )</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( dens[ <span class="st">&#39;Period&#39;</span>, ], dens[ <span class="st">&#39;Mean&#39;</span>, ] <span class="sc">+</span> dens[ <span class="st">&#39;SD&#39;</span>, ], <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">getColor</span>( col, .<span class="dv">4</span>) )</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>( <span class="st">&#39;a) Plot-species groups&#39;</span> )</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>( <span class="st">&#39;topright&#39;</span>, specs, <span class="at">text.col =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(specs)), <span class="at">bty =</span> <span class="st">&#39;n&#39;</span>, <span class="at">cex =</span> .<span class="dv">8</span> )</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>intVal <span class="ot">&lt;-</span> intVal<span class="sc">*</span>weight<span class="sc">/</span>weight</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="cn">NA</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">12</span>), <span class="at">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Density&#39;</span> )  <span class="co"># density of mean intervals</span></span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(specs) ){</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">polygon</span>( yseq, intVal[i,]<span class="sc">/</span><span class="fu">sum</span>(intVal[i,]), <span class="at">border =</span> i, <span class="at">col =</span> <span class="fu">getColor</span>(i, .<span class="dv">4</span>) )</span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>( <span class="st">&#39;b) Period estimates&#39;</span> )</span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>( <span class="st">&#39;Year&#39;</span>, <span class="dv">1</span>, <span class="at">outer =</span> T, <span class="at">cex =</span> <span class="fl">1.3</span> )</span></code></pre></div>
<p>The following block of code compiles the same densities and summaries
for year effects, which remain after accounting for other predictors in
the model. When fitted with year effects, with
<code>yearEffect   &lt;- list( groups = c( &#39;species&#39;, &#39;ecoCode&#39; ) )</code>,
the column <code>treeData$ecoCode</code> holds the ecoregion where the
tree lives. The <code>ecoRegion_species</code> combinations represent
random groups of year effects that are shared by all trees of the same
species within the same ecoregion. These combinations are
<code>rownames</code> in <code>output$parameters$betaYrRand</code>. Here
I use the function <code>mastSpectralDensity</code> to evaluate
individual rows in <code>betaYrRand</code>.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>spec  <span class="ot">&lt;-</span> <span class="fu">strsplit</span>( <span class="fu">rownames</span>( betaYrRand ), <span class="st">&#39;_&#39;</span> ) <span class="co"># extract species from ecoregion_species rownames</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>spec  <span class="ot">&lt;-</span> <span class="fu">sapply</span>( spec, <span class="cf">function</span>(x) x[<span class="dv">2</span>] )</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>specs <span class="ot">&lt;-</span> <span class="fu">sort</span>( <span class="fu">unique</span>(spec) )</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>mastMatrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="dv">0</span>, <span class="fu">nrow</span>(betaYrRand), <span class="dv">5</span> )   <span class="co"># store stats by group</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(mastMatrix) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(betaYrRand)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mastMatrix) <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;nyr&#39;</span>, <span class="st">&#39;Variance&#39;</span>, <span class="st">&#39;Volatility&#39;</span>, <span class="st">&#39;Period Est&#39;</span>, <span class="st">&#39;Period SD&#39;</span> )</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="cn">NA</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>), <span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">002</span>, .<span class="dv">4</span>), <span class="at">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;Density/yr&#39;</span>, <span class="at">log =</span> <span class="st">&#39;xy&#39;</span>)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(betaYrRand)){</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  wc <span class="ot">&lt;-</span> <span class="fu">which</span>( betaYrRand[i,] <span class="sc">!=</span> <span class="dv">0</span> )</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">length</span>(wc) <span class="sc">&lt;</span> <span class="dv">6</span> )<span class="cf">next</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">mastSpectralDensity</span>( betaYrRand[i,wc] )</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="sc">!</span><span class="fu">is.matrix</span>( s<span class="sc">$</span>spect ) )<span class="cf">next</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  mastMatrix[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="fu">length</span>(wc), s<span class="sc">$</span>totVar, s<span class="sc">$</span>volatility, s<span class="sc">$</span>periodMu, s<span class="sc">$</span>periodSd )</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  period <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>s<span class="sc">$</span>spec[, <span class="st">&#39;frequency&#39;</span> ]</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  dens   <span class="ot">&lt;-</span> s<span class="sc">$</span>spec[, <span class="st">&#39;spectralDensity&#39;</span> ]<span class="sc">/</span><span class="fu">length</span>(wc)  <span class="co"># series vary in length</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  col    <span class="ot">&lt;-</span> <span class="fu">match</span>( spec[i], specs )</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>( period, dens, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="fu">getColor</span>( col, .<span class="dv">4</span>) )</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>( <span class="st">&#39;c) Year effects&#39;</span> )</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>( <span class="st">&#39;Period (yr)&#39;</span>, <span class="dv">1</span>, <span class="at">line =</span> <span class="dv">1</span>, <span class="at">outer =</span> T )</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>keepRows   <span class="ot">&lt;-</span> <span class="fu">which</span>(  <span class="fu">is.finite</span>(mastMatrix[,<span class="st">&#39;Variance&#39;</span>]) <span class="sc">&amp;</span> mastMatrix[,<span class="st">&#39;Variance&#39;</span>] <span class="sc">!=</span> <span class="dv">0</span> )</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a><span class="co">#keepCols   &lt;- which( colSums( frequency, na.rm=T ) &gt; 0 )</span></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>mastMatrix <span class="ot">&lt;-</span> mastMatrix[ keepRows, ]</span></code></pre></div>
<p><br></p>
</div>
<div id="trouble-shooting" class="section level1">
<h1><span style="color:darkgreen">trouble shooting</span></h1>
<p>Because seed-trap studies involve multiple data sets ( seed traps,
trees, covariates ) that are collected over a number of years and
multiple sites, combining them can expose inconsistencies that are not
immediately evident. Of course, a proper analysis depends on alignment
of trees, seed traps, and covariates with unique tree names (
<code>treeData$tree</code> ) and trap names ( <code>seedData$trap</code>
) in each plot ( <code>treeData$plot, seedData$plot</code> ).</p>
<p>Notes are displayed by <code>mastif</code> at execution summarizing
aspects of the data that might trigger warnings. All of these issues
have arisen in data sets I have encountered from colleagues:</p>
<p><strong>Alignment of data frames.</strong> The unique trees in each
plot supplied in <code>treeData</code> must also appear with
<code>x</code> and <code>y</code> in <code>xytree</code>. The unique
traps in each plot supplied in <code>seedData</code> must also appear
with <code>x</code> and <code>y</code> in <code>xytrap</code>. Problems
generate a note:</p>
<p><code>Note: treeData includes trees not present in xytree</code></p>
<p><strong>Spatial coordinates.</strong> Because tree censuses and seed
traps are often done at different times, by different people, the grids
often disagree. <code>Spatial range</code> tables are displayed for ( x,
y ) coordinates in <code>xytree</code> and <code>xytrap</code>.</p>
<p><strong>Unidentified seeds.</strong> Seeds that cannot be identified
to species contain the <code>character</code> string <code>UNKN</code>.
If there are species in <code>specNames</code> that do not appear in
<code>seedNames</code>, then the <code>UNKN</code> seed type must be
included in <code>seedNames</code> and in columns of
<code>seedData</code>. For example, if <code>caryGlab, caryTome</code>
appear in <code>specNames</code>, and <code>caryGlab, caryUNKN</code>
appear in <code>seedNames</code> ( and as columns in
<code>seedData</code> ), then <code>caryUNKN</code> will be the imputed
fate for all seeds emanating from <code>caryOvat</code> and some seeds
from <code>caryGlab</code>.</p>
<p>This note will be displayed:</p>
<p><code>Note: unknown seed type is caryUNKN</code></p>
<p>If there are <code>seedNames</code> that do not appear in
<code>specNames</code>, this note is given:</p>
<p><code>Note: seedNames not in specNames and not &quot;UNKN&quot;:</code>
<code>caryCord</code></p>
<p><code>Moved caryCord to &quot;UNKN&quot; class</code></p>
<p><strong>Design issues.</strong> The design can seem confusing,
because there are multiple species on multiple plots in multiple years.
There is a design matrix that can be found here for fecundity:</p>
<p><code>output$inputs$setupData$xfec</code></p>
<p>and here for maturation:</p>
<p><code>output$inputs$setupData$xrep</code></p>
<p>( Variables are standardized, because fitting is done that way, but
coefficients are reported on their original scales. Unstandardized
versions of design matrices are <code>xfecU</code> and
<code>xrepU</code>. )</p>
<p>There should not be missing values in the columns of
<code>treeData</code> that will be used as predictors ( covariates or
factors ). If there are missing values, a note will be generated:</p>
<p><code>Fix missing values in these variables:</code>
<code>[1] &quot;yearlyPETO.tmin1, yearlyPETO.tmin2, flowering.covs.pr.data, flowering.covs.tmin.data, s.PETO&quot;</code></p>
<p>There can be missing seed counts in <code>seedData</code>–missing
values will be imputed.</p>
<p>A table containing the Variance Inflation Factor ( VIF ), range of
each variable, and correlation matrix will be generated at execution.
VIF values &gt; 10 and high correlations between covariates are taken as
evidence of redundancy. A table will be generated for each species
separately. However, in <code>xfec</code> and <code>xrep</code> they are
treated as a single matrix.</p>
<p>Year effects by random group require replication within groups. Here
is a note for the AR model showing sizes of groups defined by species
and region ( <code>NE, piedmont, sApps</code> ):</p>
<p><code>no. trees with &gt; plag years, by group:</code></p>
<pre><code>  `caryGlab-NE caryGlab-piedmont    caryGlab-sApps `
  `          1               497               361 `
  
  `caryOvat-piedmont caryTome-piedmont    caryTome-sApps `
  `        122               569                77 `</code></pre>
<p><code>small group: caryGlab-NE</code></p>
<p>There is only one tree in the <code>caryGlab-NE</code> group,
suggesting insufficient replication and a different aggregation
scheme.</p>
<p>For the AR( <span class="math inline">\(p\)</span> ) model, values
are imputed for <span class="math inline">\(p\)</span> years before and
after a tree is observed, and only trees observed for &gt; <span class="math inline">\(p\)</span> years will contribute to parameter
estimates. If the study lasts 3 years, then the model should not specify
<code>yearEffect$p = 5</code>. A note will be generated to inform on the
number of observations included in parameter estimates:</p>
<p><code>Number of full observations with AR model is: [1] 21235</code></p>
<p><strong>Prediction.</strong> If <code>predList</code> is supplied,
then fecundity and seed density will be predicted for specified
plot-years. The size of the prediction grid is displayed as a table of
prediction nodes by plot and year. Large prediction grids slow
execution. To reduce the size of the grid, increase the
<code>inputs$predList$mapMeters</code> ( the default is 5 m by 5 m
).</p>
<p>When covariates are added as columns to <code>treeData</code>, they
must align with <code>treeData$plot</code>, <code>treeData$year</code>,
and, if they are tree-level covariates, with <code>treeData$tree</code>.
The required column <code>treeData$diam</code> is an example of the
latter.</p>
</div>
<div id="references" class="section level1">
<h1><span style="color:darkgreen">references</span></h1>
<p>Qiu T., et al., 2022. Limits to reproduction and seed size-number
tradeoffs that shape forest dominance and future recovery. Nature
Communications, 13:2381 | <a href="https://doi.org/10.1038/s41467-022-30037-9" class="uri">https://doi.org/10.1038/s41467-022-30037-9</a></p>
<p>Journe, V., et al., 2022. Globally, tree fecundity exceeds
productivity gradients. Ecology Letters, DOI: 10.1111/ele.14012, pdf:
Ecology Letters2022.</p>
<p>Sharma, S., et al., 2022. North American tree migration paced by
recruitment through contrasting east-west mechanisms. Proceedings of the
National Academy of Sciences, 119 (3) e2116691118; <a href="https://doi.org/10.1073/pnas.2116691118" class="uri">https://doi.org/10.1073/pnas.2116691118</a>.</p>
<p>Qiu, T., et al., 2021. Is there tree senescence? The fecundity
evidence. Proceedings of the National Academy of Sciences, 118,
e2106130118; DOI: 10.1073/pnas.2106130118.</p>
<p>Clark, J.S., 2021. Continent-wide tree fecundity driven by indirect
climate effects. Nature Communications DOI:
10.1038/s41467-020-20836-3.</p>
<p>Clark, JS, C Nunes, and B Tomasek. 2019. Masting as an unreliable
resource: spatio-temporal host diversity merged with consumer movement,
storage, and diet. <em>Ecological Monographs</em>, 89:e01381.</p>
<p>Clark, JS, S LaDeau, and I Ibanez. 2004. Fecundity of trees and the
colonization-competition hypothesis, <em>Ecological Monographs</em>, 74,
415-442.</p>
<p>Clark, JS, M Silman, R Kern, E Macklin, and J Hille Ris Lambers.
1999. Seed dispersal near and far: generalized patterns across temperate
and tropical forests. <em>Ecology</em> 80, 1475-1494.</p>
<p>Neal, R.M. 2011. MCMC using Hamiltonian dynamics. In: <em>Handbook of
Markov Chain Monte Carlo</em>, edited by S. Brooks, A. Gelman, G. Jones,
and X.-L. Meng. Chapman &amp; Hall / CRC Press.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
